<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Mesh Visualization</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #2a2a2a;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
            background-color: #2a2a2a;
            border: 2px solid #00ff00;
        }
        
        #vtk-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            z-index: 200;
        }
        
        
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
            pointer-events: auto;
        }
        
        #controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: #00ff00;
            padding: 8px;
            border-radius: 3px;
            font-size: 11px;
            z-index: 1000;
            min-width: 140px;
            max-width: 160px;
            border: 1px solid #00ff00;
            pointer-events: auto;
        }
        
        .control-group {
            margin-bottom: 6px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 3px;
            color: #00ff00;
            font-size: 10px;
        }
        
        .control-group input, .control-group select {
            width: 100%;
            padding: 2px;
            background: #001100;
            color: #00ff00;
            border: 1px solid #00ff00;
            border-radius: 2px;
            font-size: 10px;
        }
        
        /* Colorbar removed from mesh preview - no field visualization */
    </style>
</head>
<body>
    <div id="container">
        <div id="vtk-container"></div>
        <div id="loading">Loading visualization... Generating mesh with GMSH...</div>
        <div id="info">
            <div><strong>Mesh Statistics:</strong></div>
            <div>Vertices: <span id="vertex-count">-</span></div>
            <div>Faces: <span id="face-count">-</span></div>
            <div>Type: <span id="mesh-type">-</span></div>
        </div>
        <div id="controls">
            <div class="control-group">
                <label>Representation:</label>
                <select id="representation-select" onchange="changeRepresentation(this.value);">
                    <option value="0">Points</option>
                    <option value="1">Wireframe</option>
                    <option value="2" id="surface-option">Surface</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Background:</label>
                <select id="background-select" onchange="changeBackground(this.value);">
                    <option value="#1a1a1a">Dark</option>
                    <option value="#ffffff">Light</option>
                    <option value="#000000">Black</option>
                </select>
            </div>
            <div class="control-group">
                <button id="fit-view" onclick="fitToView();" style="width: 100%; padding: 4px; background: #001100; color: #00ff00; border: 1px solid #00ff00; border-radius: 2px; cursor: pointer; margin-bottom: 3px; font-size: 10px; transition: all 0.2s ease;" onmouseover="this.style.background='#003300'; this.style.border='2px solid #00ff00';" onmouseout="this.style.background='#001100'; this.style.border='1px solid #00ff00';">Fit to View</button>
                <button id="surface-view-btn" onclick="showSurfaceView();" style="width: 100%; padding: 4px; background: #001100; color: #00ff00; border: 1px solid #00ff00; border-radius: 2px; cursor: pointer; margin-bottom: 3px; font-size: 10px; transition: all 0.2s ease;" onmouseover="this.style.background='#003300'; this.style.border='2px solid #00ff00';" onmouseout="this.style.background='#001100'; this.style.border='1px solid #00ff00';">Surface View</button>
                <button id="volume-view-btn" onclick="showVolumeView();" style="width: 100%; padding: 4px; background: #001100; color: #00ff00; border: 1px solid #00ff00; border-radius: 2px; cursor: pointer; font-size: 10px; transition: all 0.2s ease;" onmouseover="this.style.background='#003300'; this.style.border='2px solid #00ff00';" onmouseout="this.style.background='#001100'; this.style.border='1px solid #00ff00';">Volume View</button>
        </div>
            <div class="control-group">
                <div style="font-size: 9px; color: #00ff00; margin-top: 5px; line-height: 1.2;">
                    <strong>Controls:</strong><br>
                    • LMB: Rotate<br>
                    • MMB: Pan<br>
                    • RMB: Zoom<br>
                    • Wheel: Zoom
                </div>
            </div>
        </div>
        
    </div>

    <!-- VTK.js loaded locally to avoid CDN issues -->
    <script src="/static/js/vtk.js" onerror="console.error('Failed to load VTK.js script');"></script>
    
    <script>
        // Get mesh dimension from template data
        const meshDimension = 3;
        window.meshDimension = meshDimension;
        
        // Get mesh data from template data
        const fullMeshData = {"vertices": [[0.0, 0.0, 0.1], [0.0, 0.0, 0.0], [0.0, 0.1, 0.1], [0.0, 0.1, 0.0], [2.0, 0.0, 0.1], [2.0, 0.0, 0.0], [2.0, 0.1, 0.1], [2.0, 0.1, 0.0], [0.0, 0.0, 0.05], [0.0, 0.05, 0.1], [0.0, 0.1, 0.05], [0.0, 0.05, 0.0], [2.0, 0.0, 0.05], [2.0, 0.05, 0.1], [2.0, 0.1, 0.05], [2.0, 0.05, 0.0], [0.2, 0.0, 0.0], [0.4, 0.0, 0.0], [0.6, 0.0, 0.0], [0.8, 0.0, 0.0], [1.0, 0.0, 0.0], [1.2, 0.0, 0.0], [1.4, 0.0, 0.0], [1.6, 0.0, 0.0], [1.8, 0.0, 0.0], [0.1, 0.0, 0.0], [0.30000000000000004, 0.0, 0.0], [0.49999999999999994, 0.0, 0.0], [0.7, 0.0, 0.0], [0.9, 0.0, 0.0], [1.1, 0.0, 0.0], [1.2999999999999998, 0.0, 0.0], [1.5, 0.0, 0.0], [1.7000000000000002, 0.0, 0.0], [1.9, 0.0, 0.0], [0.2, 0.0, 0.1], [0.4, 0.0, 0.1], [0.6, 0.0, 0.1], [0.8, 0.0, 0.1], [1.0, 0.0, 0.1], [1.2, 0.0, 0.1], [1.4, 0.0, 0.1], [1.6, 0.0, 0.1], [1.8, 0.0, 0.1], [0.1, 0.0, 0.1], [0.30000000000000004, 0.0, 0.1], [0.49999999999999994, 0.0, 0.1], [0.7, 0.0, 0.1], [0.9, 0.0, 0.1], [1.1, 0.0, 0.1], [1.2999999999999998, 0.0, 0.1], [1.5, 0.0, 0.1], [1.7000000000000002, 0.0, 0.1], [1.9, 0.0, 0.1], [0.2, 0.1, 0.0], [0.4, 0.1, 0.0], [0.6, 0.1, 0.0], [0.8, 0.1, 0.0], [1.0, 0.1, 0.0], [1.2, 0.1, 0.0], [1.4, 0.1, 0.0], [1.6, 0.1, 0.0], [1.8, 0.1, 0.0], [0.1, 0.1, 0.0], [0.30000000000000004, 0.1, 0.0], [0.49999999999999994, 0.1, 0.0], [0.7, 0.1, 0.0], [0.9, 0.1, 0.0], [1.1, 0.1, 0.0], [1.2999999999999998, 0.1, 0.0], [1.5, 0.1, 0.0], [1.7000000000000002, 0.1, 0.0], [1.9, 0.1, 0.0], [0.2, 0.1, 0.1], [0.4, 0.1, 0.1], [0.6, 0.1, 0.1], [0.8, 0.1, 0.1], [1.0, 0.1, 0.1], [1.2, 0.1, 0.1], [1.4, 0.1, 0.1], [1.6, 0.1, 0.1], [1.8, 0.1, 0.1], [0.1, 0.1, 0.1], [0.30000000000000004, 0.1, 0.1], [0.49999999999999994, 0.1, 0.1], [0.7, 0.1, 0.1], [0.9, 0.1, 0.1], [1.1, 0.1, 0.1], [1.2999999999999998, 0.1, 0.1], [1.5, 0.1, 0.1], [1.7000000000000002, 0.1, 0.1], [1.9, 0.1, 0.1], [0.0, 0.05, 0.05], [0.0, 0.025, 0.07500000000000001], [0.0, 0.025, 0.025], [0.0, 0.07500000000000001, 0.07500000000000001], [0.0, 0.07500000000000001, 0.025], [2.0, 0.05, 0.05], [2.0, 0.025, 0.025], [2.0, 0.025, 0.07500000000000001], [2.0, 0.07500000000000001, 0.07500000000000001], [2.0, 0.07500000000000001, 0.025], [1.9000000000000001, 0.0, 0.05], [0.7, 0.0, 0.05], [1.2999999999999998, 0.0, 0.05], [1.7, 0.0, 0.049999999999999996], [0.1, 0.0, 0.05], [0.5, 0.0, 0.05], [0.30000000000000004, 0.0, 0.05000000000000001], [0.9, 0.0, 0.05], [1.5, 0.0, 0.05], [1.0999999999999999, 0.0, 0.05], [0.05, 0.0, 0.025], [0.05, 0.0, 0.07500000000000001], [0.15000000000000002, 0.0, 0.07500000000000001], [0.15000000000000002, 0.0, 0.025], [1.9500000000000002, 0.0, 0.07500000000000001], [1.9500000000000002, 0.0, 0.025], [1.85, 0.0, 0.07500000000000001], [1.85, 0.0, 0.025], [0.35000000000000003, 0.0, 0.025000000000000005], [0.25, 0.0, 0.025000000000000005], [0.2, 0.0, 0.05], [0.25, 0.0, 0.07500000000000001], [0.55, 0.0, 0.025], [0.45, 0.0, 0.025], [0.4, 0.0, 0.05], [0.45, 0.0, 0.07500000000000001], [0.35000000000000003, 0.0, 0.07500000000000001], [0.75, 0.0, 0.025], [0.6499999999999999, 0.0, 0.025], [0.6, 0.0, 0.05], [0.6499999999999999, 0.0, 0.07500000000000001], [0.55, 0.0, 0.07500000000000001], [0.95, 0.0, 0.025], [0.8500000000000001, 0.0, 0.025], [0.8, 0.0, 0.05], [0.75, 0.0, 0.07500000000000001], [0.8500000000000001, 0.0, 0.07500000000000001], [1.15, 0.0, 0.025], [1.0499999999999998, 0.0, 0.025], [1.0, 0.0, 0.05], [0.95, 0.0, 0.07500000000000001], [1.0499999999999998, 0.0, 0.07500000000000001], [1.3499999999999999, 0.0, 0.025], [1.25, 0.0, 0.025], [1.2, 0.0, 0.05], [1.25, 0.0, 0.07500000000000001], [1.15, 0.0, 0.07500000000000001], [1.55, 0.0, 0.025], [1.45, 0.0, 0.025], [1.4, 0.0, 0.05], [1.3499999999999999, 0.0, 0.07500000000000001], [1.45, 0.0, 0.07500000000000001], [1.75, 0.0, 0.024999999999999998], [1.65, 0.0, 0.024999999999999998], [1.6, 0.0, 0.05], [1.65, 0.0, 0.075], [1.55, 0.0, 0.07500000000000001], [1.8, 0.0, 0.05], [1.75, 0.0, 0.075], [0.7, 0.1, 0.05], [1.2999999999999998, 0.1, 0.05], [0.1, 0.1, 0.049999999999999996], [0.30000000000000004, 0.1, 0.05], [0.5, 0.1, 0.05], [0.8999999999999999, 0.1, 0.05], [1.5, 0.1, 0.05], [1.9, 0.1, 0.05], [1.0999999999999999, 0.1, 0.05], [1.7000000000000002, 0.1, 0.05], [0.05, 0.1, 0.075], [0.05, 0.1, 0.024999999999999998], [0.15000000000000002, 0.1, 0.075], [0.15000000000000002, 0.1, 0.024999999999999998], [1.95, 0.1, 0.025], [1.95, 0.1, 0.07500000000000001], [1.85, 0.1, 0.07500000000000001], [1.85, 0.1, 0.025], [0.25, 0.1, 0.025], [0.35000000000000003, 0.1, 0.025], [0.2, 0.1, 0.05], [0.25, 0.1, 0.07500000000000001], [0.45, 0.1, 0.025], [0.55, 0.1, 0.025], [0.35000000000000003, 0.1, 0.07500000000000001], [0.4, 0.1, 0.05], [0.45, 0.1, 0.07500000000000001], [0.6499999999999999, 0.1, 0.025], [0.75, 0.1, 0.025], [0.6499999999999999, 0.1, 0.07500000000000001], [0.6, 0.1, 0.05], [0.55, 0.1, 0.07500000000000001], [0.85, 0.1, 0.025], [0.95, 0.1, 0.025], [0.75, 0.1, 0.07500000000000001], [0.8, 0.1, 0.05], [0.85, 0.1, 0.07500000000000001], [1.0499999999999998, 0.1, 0.025], [1.15, 0.1, 0.025], [0.95, 0.1, 0.07500000000000001], [1.0, 0.1, 0.05], [1.0499999999999998, 0.1, 0.07500000000000001], [1.25, 0.1, 0.025], [1.3499999999999999, 0.1, 0.025], [1.25, 0.1, 0.07500000000000001], [1.2, 0.1, 0.05], [1.15, 0.1, 0.07500000000000001], [1.45, 0.1, 0.025], [1.55, 0.1, 0.025], [1.3499999999999999, 0.1, 0.07500000000000001], [1.4, 0.1, 0.05], [1.45, 0.1, 0.07500000000000001], [1.6500000000000001, 0.1, 0.025], [1.75, 0.1, 0.025], [1.55, 0.1, 0.07500000000000001], [1.6, 0.1, 0.05], [1.6500000000000001, 0.1, 0.07500000000000001], [1.8, 0.1, 0.05], [1.75, 0.1, 0.07500000000000001], [1.9, 0.05, 0.0], [1.1, 0.05000000000000001, 0.0], [0.7, 0.05, 0.0], [1.2999999999999998, 0.05, 0.0], [0.1, 0.05, 0.0], [0.30000000000000004, 0.05, 0.0], [0.5, 0.05, 0.0], [0.8999999999999999, 0.05, 0.0], [1.5, 0.05, 0.0], [1.7000000000000002, 0.05, 0.0], [0.05, 0.07500000000000001, 0.0], [0.05, 0.025, 0.0], [0.15000000000000002, 0.025, 0.0], [0.15000000000000002, 0.07500000000000001, 0.0], [1.95, 0.025, 0.0], [1.95, 0.07500000000000001, 0.0], [1.85, 0.025, 0.0], [1.85, 0.07500000000000001, 0.0], [0.25, 0.025, 0.0], [0.35000000000000003, 0.025, 0.0], [0.2, 0.05, 0.0], [0.25, 0.07500000000000001, 0.0], [0.45, 0.025, 0.0], [0.55, 0.025, 0.0], [0.4, 0.05, 0.0], [0.35000000000000003, 0.07500000000000001, 0.0], [0.45, 0.07500000000000001, 0.0], [0.6499999999999999, 0.025, 0.0], [0.75, 0.025, 0.0], [0.6, 0.05, 0.0], [0.6499999999999999, 0.07500000000000001, 0.0], [0.55, 0.07500000000000001, 0.0], [0.85, 0.025, 0.0], [0.95, 0.025, 0.0], [0.8, 0.05, 0.0], [0.75, 0.07500000000000001, 0.0], [0.85, 0.07500000000000001, 0.0], [1.05, 0.025000000000000005, 0.0], [1.15, 0.025000000000000005, 0.0], [1.0, 0.05, 0.0], [1.05, 0.07500000000000001, 0.0], [0.95, 0.07500000000000001, 0.0], [1.25, 0.025, 0.0], [1.3499999999999999, 0.025, 0.0], [1.2, 0.05, 0.0], [1.15, 0.07500000000000001, 0.0], [1.25, 0.07500000000000001, 0.0], [1.45, 0.025, 0.0], [1.55, 0.025, 0.0], [1.4, 0.05, 0.0], [1.3499999999999999, 0.07500000000000001, 0.0], [1.45, 0.07500000000000001, 0.0], [1.6500000000000001, 0.025, 0.0], [1.75, 0.025, 0.0], [1.6, 0.05, 0.0], [1.55, 0.07500000000000001, 0.0], [1.6500000000000001, 0.07500000000000001, 0.0], [1.8, 0.05, 0.0], [1.75, 0.07500000000000001, 0.0], [1.0999999999999999, 0.05, 0.1], [1.2999999999999998, 0.05000000000000001, 0.1], [1.7, 0.05, 0.1], [0.3, 0.05, 0.1], [0.5, 0.05, 0.1], [0.9, 0.05, 0.1], [0.1, 0.049999999999999996, 0.1], [1.5, 0.05, 0.1], [0.7, 0.05, 0.1], [1.9, 0.05, 0.1], [0.05, 0.024999999999999998, 0.1], [0.05, 0.075, 0.1], [0.15000000000000002, 0.024999999999999998, 0.1], [0.15000000000000002, 0.075, 0.1], [1.95, 0.07500000000000001, 0.1], [1.95, 0.025, 0.1], [1.85, 0.025, 0.1], [1.85, 0.07500000000000001, 0.1], [0.35, 0.025, 0.1], [0.25, 0.025, 0.1], [0.25, 0.07500000000000001, 0.1], [0.2, 0.05, 0.1], [0.55, 0.025, 0.1], [0.45, 0.025, 0.1], [0.35, 0.07500000000000001, 0.1], [0.4, 0.05, 0.1], [0.45, 0.07500000000000001, 0.1], [0.75, 0.025, 0.1], [0.6499999999999999, 0.025, 0.1], [0.55, 0.07500000000000001, 0.1], [0.6, 0.05, 0.1], [0.6499999999999999, 0.07500000000000001, 0.1], [0.95, 0.025, 0.1], [0.8500000000000001, 0.025, 0.1], [0.8500000000000001, 0.07500000000000001, 0.1], [0.8, 0.05, 0.1], [0.75, 0.07500000000000001, 0.1], [1.15, 0.025, 0.1], [1.0499999999999998, 0.025, 0.1], [1.0499999999999998, 0.07500000000000001, 0.1], [1.0, 0.05, 0.1], [0.95, 0.07500000000000001, 0.1], [1.3499999999999999, 0.025000000000000005, 0.1], [1.25, 0.025000000000000005, 0.1], [1.15, 0.07500000000000001, 0.1], [1.2, 0.05, 0.1], [1.25, 0.07500000000000001, 0.1], [1.55, 0.025, 0.1], [1.45, 0.025, 0.1], [1.3499999999999999, 0.07500000000000001, 0.1], [1.4, 0.05, 0.1], [1.45, 0.07500000000000001, 0.1], [1.75, 0.025, 0.1], [1.65, 0.025, 0.1], [1.65, 0.07500000000000001, 0.1], [1.6, 0.05, 0.1], [1.55, 0.07500000000000001, 0.1], [1.75, 0.07500000000000001, 0.1], [1.8, 0.05, 0.1], [0.4005401669651204, 0.05021975674915539, 0.049495115569911007], [1.5020869630017648, 0.04999019031374664, 0.050000551402578405], [0.6671562073074822, 0.057391268805217256, 0.05040610148844039], [0.10117735733964286, 0.05000069921120903, 0.03668547098237715], [0.3007021506270943, 0.05000505063944293, 0.05058801003209107], [1.6974938782915223, 0.05001523032724539, 0.049971119744624856], [1.9044866840002321, 0.05000042792508796, 0.06400305794836277], [1.0989581426525832, 0.06330349169412818, 0.04999976578164778], [0.5013886958238818, 0.049941608602581795, 0.04998559415096304], [0.899464003874237, 0.05002736035922493, 0.05003210067438524], [1.3006796606340032, 0.04999986829015693, 0.050000009320330475], [0.7480705739732666, 0.04438213704403625, 0.04346122902890934], [0.10108196853361352, 0.049997543102383205, 0.06333072833671029], [1.098954610821409, 0.0366954110799689, 0.05000120081960264], [1.8747551811236232, 0.05000421772865241, 0.03886347742657203], [0.7025409520782572, 0.03185095908005678, 0.06755422218559491], [0.04079652274705469, 0.049999853855060575, 0.049994182365121445], [1.9574792607777354, 0.050000705826002155, 0.04744509357705955], [1.4002407341896248, 0.050001136474767685, 0.05000025543946053], [0.16574123981621916, 0.050003110369370544, 0.05015171184809117], [1.7961942568397635, 0.05000336225640858, 0.048855422631321845], [1.1648211830179482, 0.04999964430044715, 0.050000499253138125], [0.2153228784691974, 0.0500014975950707, 0.05016313765936699], [1.0281129741653903, 0.050000263363537835, 0.05000048057824125], [1.2149262689095919, 0.04999993961062086, 0.050000030460758925], [1.4510434815008824, 0.07499509515687332, 0.0750002757012892], [1.5510434815008824, 0.07499509515687332, 0.0750002757012892], [1.5010434815008824, 0.07499509515687332, 0.050000275701289204], [1.4510434815008824, 0.02499509515687332, 0.025000275701289203], [1.5510434815008824, 0.02499509515687332, 0.025000275701289203], [1.5010434815008824, 0.04999509515687332, 0.025000275701289203], [0.6335781036537411, 0.07869563440260863, 0.025203050744220194], [0.7335781036537411, 0.07869563440260863, 0.025203050744220194], [0.683578103653741, 0.07869563440260863, 0.0502030507442202], [0.05058867866982143, 0.07500034960560452, 0.018342735491188575], [0.15058867866982145, 0.07500034960560452, 0.018342735491188575], [0.10058867866982144, 0.07500034960560452, 0.04334273549118857], [1.4510434815008824, 0.02499509515687332, 0.0750002757012892], [1.5510434815008824, 0.02499509515687332, 0.0750002757012892], [1.5010434815008824, 0.02499509515687332, 0.050000275701289204], [1.0494790713262916, 0.08165174584706408, 0.02499988289082389], [1.0994790713262916, 0.05665174584706409, 0.02499988289082389], [1.0635355584089867, 0.05665187752883301, 0.05000012317994452], [1.0640564870826952, 0.05000013168176892, 0.025000240289120627], [1.0140564870826951, 0.07500013168176892, 0.025000240289120627], [0.7740352869866334, 0.022191068522018124, 0.02173061451445467], [0.7240352869866333, 0.022191068522018124, 0.04673061451445467], [0.6740352869866333, 0.022191068522018124, 0.02173061451445467], [1.098956376736996, 0.04999945138704853, 0.05000048330062521], [1.0994773054107045, 0.04334770553998445, 0.02500060040980132], [1.0635337924933996, 0.043347837221753366, 0.050000840698921946], [1.1318878969196786, 0.043347527690208026, 0.05000085003637038], [1.1318896628352657, 0.05665156799728766, 0.05000013251739295], [1.0994790713262916, 0.05665174584706409, 0.07499988289082389], [1.132410591508974, 0.049999822150223576, 0.07500024962656907], [1.0994773054107045, 0.043347705539984446, 0.07500060040980132], [0.7512704760391287, 0.01592547954002839, 0.08377711109279745], [0.7012704760391286, 0.01592547954002839, 0.05877711109279746], [0.6512704760391286, 0.01592547954002839, 0.08377711109279745], [0.7335781036537411, 0.07869563440260863, 0.07520305074422019], [0.6335781036537411, 0.07869563440260863, 0.07520305074422019], [0.35035107531354714, 0.07500252531972147, 0.07529400501604554], [0.3003510753135472, 0.07500252531972147, 0.050294005016045536], [0.25035107531354717, 0.07500252531972147, 0.07529400501604554], [0.05054098426680676, 0.07499877155119161, 0.08166536416835515], [0.15054098426680676, 0.07499877155119161, 0.08166536416835515], [0.10054098426680677, 0.07499877155119161, 0.056665364168355145], [0.35035107531354714, 0.025002525319721466, 0.025294005016045534], [0.25035107531354717, 0.025002525319721466, 0.025294005016045534], [0.3003510753135472, 0.025002525319721466, 0.05029400501604554], [1.1494790713262915, 0.08165174584706408, 0.02499988289082389], [0.35035107531354714, 0.07500252531972147, 0.025294005016045534], [0.25035107531354717, 0.07500252531972147, 0.025294005016045534], [0.3003510753135472, 0.050002525319721464, 0.025294005016045534], [1.6487469391457612, 0.025007615163622696, 0.024985559872312428], [1.698746939145761, 0.025007615163622696, 0.04998555987231243], [1.7487469391457613, 0.025007615163622696, 0.024985559872312428], [1.852243342000116, 0.02500021396254398, 0.08200152897418139], [1.9022433420001161, 0.02500021396254398, 0.057001528974181384], [1.952243342000116, 0.02500021396254398, 0.08200152897418139], [1.2503398303170017, 0.024999934145078465, 0.07500000466016524], [1.2503398303170017, 0.07499993414507847, 0.07500000466016524], [1.2578029647717974, 0.04999990395038889, 0.0500000198905447], [1.207463134454796, 0.07499996980531043, 0.07500001523037947], [1.207463134454796, 0.02499996980531043, 0.07500001523037947], [1.1494790713262915, 0.08165174584706408, 0.07499988289082389], [1.0494790713262916, 0.08165174584706408, 0.07499988289082389], [1.0994790713262916, 0.08165174584706408, 0.049999882890823896], [1.1824105915089742, 0.07499982215022358, 0.07500024962656907], [1.1824105915089742, 0.024999822150223575, 0.07500024962656907], [1.18987372596377, 0.049999791955534, 0.05000026485694853], [0.4506943479119409, 0.024970804301290898, 0.02499279707548152], [0.5506943479119408, 0.024970804301290898, 0.02499279707548152], [0.5006943479119409, 0.024970804301290898, 0.04999279707548152], [0.4506943479119409, 0.0749708043012909, 0.02499279707548152], [0.4509644313945011, 0.05008068267586859, 0.04974035486043703], [0.4002700834825602, 0.025109878374577694, 0.024747557784955503], [0.4002700834825602, 0.0751098783745777, 0.024747557784955503], [1.1494773054107044, 0.01834770553998445, 0.07500060040980132], [1.0494773054107045, 0.01834770553998445, 0.07500060040980132], [1.0994773054107045, 0.01834770553998445, 0.050000600409801324], [0.9497320019371185, 0.025013680179612464, 0.07501605033719262], [0.8497320019371185, 0.025013680179612464, 0.07501605033719262], [0.8997320019371184, 0.025013680179612464, 0.05001605033719262], [1.1494773054107044, 0.01834770553998445, 0.02500060040980132], [1.1824105915089742, 0.024999822150223575, 0.025000249626569063], [1.9373775905618116, 0.025002108864326206, 0.019431738713286014], [1.8873775905618118, 0.025002108864326206, 0.04443173871328601], [1.8373775905618115, 0.025002108864326206, 0.019431738713286014], [0.8497320019371185, 0.025013680179612464, 0.02501605033719262], [0.9497320019371185, 0.025013680179612464, 0.02501605033719262], [1.7487469391457613, 0.0750076151636227, 0.07498555987231242], [1.6487469391457612, 0.0750076151636227, 0.07498555987231242], [1.6987469391457612, 0.0750076151636227, 0.04998555987231243], [1.3503398303170016, 0.07499993414507847, 0.025000004660165238], [1.2503398303170017, 0.07499993414507847, 0.025000004660165238], [1.3003398303170015, 0.07499993414507847, 0.05000000466016524], [1.2503398303170017, 0.024999934145078465, 0.025000004660165238], [1.3503398303170016, 0.024999934145078465, 0.025000004660165238], [1.3003398303170015, 0.049999934145078466, 0.025000004660165238], [0.5506943479119408, 0.0749708043012909, 0.07499279707548152], [0.5006943479119409, 0.0749708043012909, 0.04999279707548152], [0.4506943479119409, 0.0749708043012909, 0.07499279707548152], [1.1824105915089742, 0.07499982215022358, 0.025000249626569063], [1.1324105915089742, 0.04999982215022358, 0.025000249626569063], [1.207463134454796, 0.07499996980531043, 0.025000015230379462], [1.3503398303170016, 0.07499993414507847, 0.07500000466016524], [0.8497320019371185, 0.07501368017961246, 0.02501605033719262], [0.8237672889237517, 0.04720474870163059, 0.04674666485164729], [0.7740352869866334, 0.07219106852201812, 0.02173061451445467], [1.9161172209506794, 0.050002461777327284, 0.043154285501815784], [1.9309829723889838, 0.050000566875545056, 0.055724075762711156], [1.8896209325619275, 0.050002322826870185, 0.05143326768746739], [1.9287396303888678, 0.025000352913001078, 0.048722546788529775], [1.3503398303170016, 0.024999934145078465, 0.07500000466016524], [1.3003398303170015, 0.024999934145078465, 0.05000000466016524], [0.4506943479119409, 0.024970804301290898, 0.07499279707548152], [0.4002700834825602, 0.025109878374577694, 0.07474755778495551], [0.4002700834825602, 0.0751098783745777, 0.07474755778495551], [0.020398261373527345, 0.024999926927530287, 0.07499709118256073], [0.0709392456403341, 0.04999869847872189, 0.056662455350915866], [0.05054098426680676, 0.024998771551191602, 0.08166536416835515], [0.10054098426680677, 0.024998771551191602, 0.056665364168355145], [0.07039826137352735, 0.024999926927530287, 0.049997091182560724], [0.020398261373527345, 0.024999926927530287, 0.024997091182560723], [0.05058867866982143, 0.025000349605604516, 0.018342735491188575], [0.10058867866982144, 0.025000349605604516, 0.043342735491188576], [0.07098694004334878, 0.0500002765331348, 0.0433398266737493], [1.9787396303888678, 0.07500035291300108, 0.07372254678852977], [1.952243342000116, 0.07500021396254399, 0.08200152897418139], [1.9022433420001161, 0.07500021396254399, 0.057001528974181384], [1.9287396303888675, 0.07500035291300108, 0.048722546788529775], [1.9787396303888678, 0.07500035291300108, 0.023722546788529773], [1.9373775905618116, 0.0750021088643262, 0.019431738713286014], [1.8873775905618115, 0.0750021088643262, 0.04443173871328601], [1.0494773054107045, 0.01834770553998445, 0.02500060040980132], [1.7487469391457613, 0.0750076151636227, 0.024985559872312428], [1.6487469391457612, 0.0750076151636227, 0.024985559872312428], [0.2076614392345987, 0.02500074879753535, 0.025081568829683494], [0.2580125145481459, 0.050003274117256816, 0.05037557384572903], [0.2076614392345987, 0.02500074879753535, 0.0750815688296835], [0.25035107531354717, 0.025002525319721466, 0.07529400501604554], [0.13287061990810958, 0.07500155518468528, 0.05007585592404558], [0.133459298577931, 0.05000190479028979, 0.04341859141523416], [0.1828706199081096, 0.07500155518468528, 0.025075855924045584], [1.9787396303888678, 0.025000352913001078, 0.07372254678852977], [0.35035107531354714, 0.025002525319721466, 0.07529400501604554], [0.5506943479119408, 0.0749708043012909, 0.02499279707548152], [0.5506943479119408, 0.024970804301290898, 0.07499279707548152], [0.1011296629366282, 0.04999912115679612, 0.05000809965954372], [0.13341160417491635, 0.05000032673587687, 0.05674122009240073], [1.8373775905618115, 0.0750021088643262, 0.06943173871328602], [1.852243342000116, 0.07500021396254399, 0.08200152897418139], [1.5510434815008824, 0.07499509515687332, 0.025000275701289203], [1.4510434815008824, 0.07499509515687332, 0.025000275701289203], [1.064056487082695, 0.05000013168176892, 0.07500024028912063], [1.0140564870826951, 0.025000131681768917, 0.07500024028912063], [1.207463134454796, 0.02499996980531043, 0.025000015230379462], [0.6848485796928696, 0.044621113942637014, 0.05898016183701765], [0.6335781036537411, 0.028695634402608628, 0.07520305074422019], [0.683578103653741, 0.028695634402608628, 0.0502030507442202], [0.9497320019371185, 0.07501368017961246, 0.07501605033719262], [1.0140564870826951, 0.07500013168176892, 0.07500024028912063], [0.9637884890198136, 0.05001381186138138, 0.05001629062631324], [0.7253057630257619, 0.038116548062046514, 0.055507725607252124], [0.7076133906403743, 0.050886702924626756, 0.04693366525867486], [1.4001203670948124, 0.07500056823738385, 0.025000127719730265], [1.4001203670948124, 0.025000568237383843, 0.025000127719730265], [1.350460197411814, 0.05000050238246231, 0.05000013237989551], [0.9497320019371185, 0.07501368017961246, 0.02501605033719262], [1.6487469391457612, 0.025007615163622696, 0.07498555987231242], [1.7487469391457613, 0.025007615163622696, 0.07498555987231242], [1.3003398303170015, 0.04999993414507847, 0.07500000466016524], [0.7240352869866333, 0.047191068522018126, 0.07173061451445467], [0.683578103653741, 0.05369563440260863, 0.07520305074422019], [0.7012704760391286, 0.04092547954002839, 0.08377711109279745], [1.4511638485956948, 0.049995663394257164, 0.05000040342101947], [1.4001203670948124, 0.07500056823738385, 0.07500012771973028], [1.4001203670948124, 0.025000568237383843, 0.07500012771973028], [1.6987469391457612, 0.0500076151636227, 0.024985559872312428], [0.19053205914270827, 0.05000230398222062, 0.05015742475372908], [0.1828706199081096, 0.025001555184685272, 0.07507585592404559], [0.1828706199081096, 0.025001555184685272, 0.025075855924045584], [0.2076614392345987, 0.07500074879753535, 0.0750815688296835], [0.1828706199081096, 0.07500155518468528, 0.07507585592404559], [0.2076614392345987, 0.07500074879753535, 0.025081568829683494], [0.15058867866982145, 0.025000349605604516, 0.018342735491188575], [0.13287061990810958, 0.025001555184685272, 0.050075855924045586], [1.9787396303888678, 0.025000352913001078, 0.023722546788529773], [0.7740352869866334, 0.022191068522018124, 0.07173061451445467], [0.30035107531354716, 0.050002525319721464, 0.07529400501604554], [1.698746939145761, 0.0500076151636227, 0.07498555987231242], [0.5006943479119409, 0.0499708043012909, 0.02499279707548152], [1.5997904206466436, 0.05000271032049601, 0.04998583557360163], [0.35062115879610734, 0.05011240369429916, 0.05004156280100104], [0.8997320019371184, 0.05001368017961247, 0.02501605033719262], [0.8997320019371184, 0.07501368017961246, 0.05001605033719262], [0.8497320019371185, 0.07501368017961246, 0.07501605033719262], [0.6335781036537411, 0.028695634402608628, 0.025203050744220194], [0.584272451565682, 0.053666438703899526, 0.05019584781970171], [1.0140564870826951, 0.025000131681768917, 0.025000240289120627], [1.5010434815008824, 0.04999509515687332, 0.0750002757012892], [0.020398261373527345, 0.0749999269275303, 0.07499709118256073], [0.07039826137352735, 0.0749999269275303, 0.049997091182560724], [0.020398261373527345, 0.0749999269275303, 0.024997091182560723], [0.7740352869866334, 0.07219106852201812, 0.07173061451445467], [1.746844067565643, 0.05000929629182699, 0.049413271187973354], [1.7980971284198817, 0.0750016811282043, 0.024427711315660922], [1.7980971284198817, 0.0750016811282043, 0.07442771131566092], [1.8354747189816933, 0.050003789992530495, 0.043859450028946936], [1.7980971284198817, 0.02500168112820429, 0.024427711315660922], [1.7980971284198817, 0.02500168112820429, 0.07442771131566092], [1.8373775905618115, 0.025002108864326206, 0.06943173871328602], [1.8373775905618115, 0.0750021088643262, 0.019431738713286014], [0.15054098426680676, 0.024998771551191602, 0.08166536416835515], [0.8997320019371184, 0.05001368017961247, 0.07501605033719262], [1.9787396303888678, 0.050000352913001075, 0.048722546788529775], [1.9022433420001161, 0.05000021396254398, 0.08200152897418139], [0.020398261373527345, 0.04999992692753029, 0.049997091182560724], [0.10054098426680677, 0.049998771551191604, 0.08166536416835515], [0.5006943479119409, 0.0499708043012909, 0.07499279707548152], [0.683578103653741, 0.05369563440260863, 0.025203050744220194], [1.8873775905618115, 0.05000210886432621, 0.019431738713286014], [0.10058867866982144, 0.05000034960560452, 0.018342735491188575], [0.7240352869866333, 0.047191068522018126, 0.02173061451445467]], "faces": [[1, 0, 92], [0, 2, 92], [3, 1, 92], [2, 3, 92], [5, 97, 4], [4, 97, 6], [7, 97, 5], [6, 97, 7], [0, 1, 106], [35, 0, 106], [1, 16, 106], [5, 4, 102], [4, 43, 102], [24, 5, 102], [16, 17, 108], [16, 35, 106], [35, 16, 108], [17, 18, 107], [36, 17, 107], [17, 36, 108], [18, 19, 103], [37, 18, 103], [18, 37, 107], [19, 20, 109], [19, 38, 103], [38, 19, 109], [20, 21, 111], [20, 39, 109], [39, 20, 111], [21, 22, 104], [40, 21, 104], [21, 40, 111], [22, 23, 110], [22, 41, 104], [41, 22, 110], [23, 24, 105], [42, 23, 105], [23, 42, 110], [43, 24, 102], [24, 43, 105], [36, 35, 108], [37, 36, 107], [38, 37, 103], [39, 38, 109], [40, 39, 111], [41, 40, 104], [42, 41, 110], [43, 42, 105], [2, 163, 3], [73, 163, 2], [3, 163, 54], [7, 168, 6], [6, 168, 81], [62, 168, 7], [54, 164, 55], [54, 163, 73], [73, 164, 54], [55, 165, 56], [55, 164, 74], [74, 165, 55], [56, 161, 57], [75, 161, 56], [56, 165, 75], [57, 166, 58], [57, 161, 76], [76, 166, 57], [58, 169, 59], [58, 166, 77], [77, 169, 58], [59, 162, 60], [78, 162, 59], [59, 169, 78], [60, 167, 61], [60, 162, 79], [79, 167, 60], [61, 170, 62], [61, 167, 80], [80, 170, 61], [81, 168, 62], [62, 170, 81], [74, 164, 73], [75, 165, 74], [76, 161, 75], [77, 166, 76], [78, 169, 77], [79, 162, 78], [80, 167, 79], [81, 170, 80], [1, 3, 224], [16, 1, 224], [3, 54, 224], [7, 5, 220], [5, 24, 220], [62, 7, 220], [17, 16, 225], [54, 16, 224], [16, 54, 225], [18, 17, 226], [55, 17, 225], [17, 55, 226], [19, 18, 222], [18, 56, 222], [56, 18, 226], [20, 19, 227], [57, 19, 222], [19, 57, 227], [21, 20, 221], [20, 58, 221], [58, 20, 227], [22, 21, 223], [59, 21, 221], [21, 59, 223], [23, 22, 228], [60, 22, 223], [22, 60, 228], [24, 23, 229], [61, 23, 228], [23, 61, 229], [24, 62, 220], [62, 24, 229], [54, 55, 225], [55, 56, 226], [56, 57, 222], [57, 58, 227], [58, 59, 221], [59, 60, 223], [60, 61, 228], [61, 62, 229], [0, 285, 2], [35, 285, 0], [2, 285, 73], [6, 288, 4], [4, 288, 43], [81, 288, 6], [36, 282, 35], [35, 282, 73], [73, 285, 35], [37, 283, 36], [74, 282, 36], [36, 283, 74], [38, 287, 37], [75, 283, 37], [37, 287, 75], [39, 284, 38], [38, 284, 76], [76, 287, 38], [40, 279, 39], [39, 279, 77], [77, 284, 39], [41, 280, 40], [78, 279, 40], [40, 280, 78], [42, 286, 41], [79, 280, 41], [41, 286, 79], [43, 281, 42], [42, 281, 80], [80, 286, 42], [81, 281, 43], [43, 288, 81], [73, 282, 74], [74, 283, 75], [75, 287, 76], [76, 284, 77], [77, 279, 78], [78, 280, 79], [79, 286, 80], [80, 281, 81]], "cells": {"triangle_2nd": [[1, 0, 92, 8, 93, 94], [0, 2, 92, 9, 95, 93], [3, 1, 92, 11, 94, 96], [2, 3, 92, 10, 96, 95], [5, 97, 4, 98, 99, 12], [4, 97, 6, 99, 100, 13], [7, 97, 5, 101, 98, 15], [6, 97, 7, 100, 101, 14], [0, 1, 106, 8, 112, 113], [35, 0, 106, 44, 113, 114], [1, 16, 106, 25, 115, 112], [5, 4, 102, 12, 116, 117], [4, 43, 102, 53, 118, 116], [24, 5, 102, 34, 117, 119], [16, 17, 108, 26, 120, 121], [16, 35, 106, 122, 114, 115], [35, 16, 108, 122, 121, 123], [17, 18, 107, 27, 124, 125], [36, 17, 107, 126, 125, 127], [17, 36, 108, 126, 128, 120], [18, 19, 103, 28, 129, 130], [37, 18, 103, 131, 130, 132], [18, 37, 107, 131, 133, 124], [19, 20, 109, 29, 134, 135], [19, 38, 103, 136, 137, 129], [38, 19, 109, 136, 135, 138], [20, 21, 111, 30, 139, 140], [20, 39, 109, 141, 142, 134], [39, 20, 111, 141, 140, 143], [21, 22, 104, 31, 144, 145], [40, 21, 104, 146, 145, 147], [21, 40, 111, 146, 148, 139], [22, 23, 110, 32, 149, 150], [22, 41, 104, 151, 152, 144], [41, 22, 110, 151, 150, 153], [23, 24, 105, 33, 154, 155], [42, 23, 105, 156, 155, 157], [23, 42, 110, 156, 158, 149], [43, 24, 102, 159, 119, 118], [24, 43, 105, 159, 160, 154], [36, 35, 108, 45, 123, 128], [37, 36, 107, 46, 127, 133], [38, 37, 103, 47, 132, 137], [39, 38, 109, 48, 138, 142], [40, 39, 111, 49, 143, 148], [41, 40, 104, 50, 147, 152], [42, 41, 110, 51, 153, 158], [43, 42, 105, 52, 157, 160], [2, 163, 3, 171, 172, 10], [73, 163, 2, 173, 171, 82], [3, 163, 54, 172, 174, 63], [7, 168, 6, 175, 176, 14], [6, 168, 81, 176, 177, 91], [62, 168, 7, 178, 175, 72], [54, 164, 55, 179, 180, 64], [54, 163, 73, 174, 173, 181], [73, 164, 54, 182, 179, 181], [55, 165, 56, 183, 184, 65], [55, 164, 74, 180, 185, 186], [74, 165, 55, 187, 183, 186], [56, 161, 57, 188, 189, 66], [75, 161, 56, 190, 188, 191], [56, 165, 75, 184, 192, 191], [57, 166, 58, 193, 194, 67], [57, 161, 76, 189, 195, 196], [76, 166, 57, 197, 193, 196], [58, 169, 59, 198, 199, 68], [58, 166, 77, 194, 200, 201], [77, 169, 58, 202, 198, 201], [59, 162, 60, 203, 204, 69], [78, 162, 59, 205, 203, 206], [59, 169, 78, 199, 207, 206], [60, 167, 61, 208, 209, 70], [60, 162, 79, 204, 210, 211], [79, 167, 60, 212, 208, 211], [61, 170, 62, 213, 214, 71], [61, 167, 80, 209, 215, 216], [80, 170, 61, 217, 213, 216], [81, 168, 62, 177, 178, 218], [62, 170, 81, 214, 219, 218], [74, 164, 73, 185, 182, 83], [75, 165, 74, 192, 187, 84], [76, 161, 75, 195, 190, 85], [77, 166, 76, 200, 197, 86], [78, 169, 77, 207, 202, 87], [79, 162, 78, 210, 205, 88], [80, 167, 79, 215, 212, 89], [81, 170, 80, 219, 217, 90], [1, 3, 224, 11, 230, 231], [16, 1, 224, 25, 231, 232], [3, 54, 224, 63, 233, 230], [7, 5, 220, 15, 234, 235], [5, 24, 220, 34, 236, 234], [62, 7, 220, 72, 235, 237], [17, 16, 225, 26, 238, 239], [54, 16, 224, 240, 232, 233], [16, 54, 225, 240, 241, 238], [18, 17, 226, 27, 242, 243], [55, 17, 225, 244, 239, 245], [17, 55, 226, 244, 246, 242], [19, 18, 222, 28, 247, 248], [18, 56, 222, 249, 250, 247], [56, 18, 226, 249, 243, 251], [20, 19, 227, 29, 252, 253], [57, 19, 222, 254, 248, 255], [19, 57, 227, 254, 256, 252], [21, 20, 221, 30, 257, 258], [20, 58, 221, 259, 260, 257], [58, 20, 227, 259, 253, 261], [22, 21, 223, 31, 262, 263], [59, 21, 221, 264, 258, 265], [21, 59, 223, 264, 266, 262], [23, 22, 228, 32, 267, 268], [60, 22, 223, 269, 263, 270], [22, 60, 228, 269, 271, 267], [24, 23, 229, 33, 272, 273], [61, 23, 228, 274, 268, 275], [23, 61, 229, 274, 276, 272], [24, 62, 220, 277, 237, 236], [62, 24, 229, 277, 273, 278], [54, 55, 225, 64, 245, 241], [55, 56, 226, 65, 251, 246], [56, 57, 222, 66, 255, 250], [57, 58, 227, 67, 261, 256], [58, 59, 221, 68, 265, 260], [59, 60, 223, 69, 270, 266], [60, 61, 228, 70, 275, 271], [61, 62, 229, 71, 278, 276], [0, 285, 2, 289, 290, 9], [35, 285, 0, 291, 289, 44], [2, 285, 73, 290, 292, 82], [6, 288, 4, 293, 294, 13], [4, 288, 43, 294, 295, 53], [81, 288, 6, 296, 293, 91], [36, 282, 35, 297, 298, 45], [35, 282, 73, 298, 299, 300], [73, 285, 35, 292, 291, 300], [37, 283, 36, 301, 302, 46], [74, 282, 36, 303, 297, 304], [36, 283, 74, 302, 305, 304], [38, 287, 37, 306, 307, 47], [75, 283, 37, 308, 301, 309], [37, 287, 75, 307, 310, 309], [39, 284, 38, 311, 312, 48], [38, 284, 76, 312, 313, 314], [76, 287, 38, 315, 306, 314], [40, 279, 39, 316, 317, 49], [39, 279, 77, 317, 318, 319], [77, 284, 39, 320, 311, 319], [41, 280, 40, 321, 322, 50], [78, 279, 40, 323, 316, 324], [40, 280, 78, 322, 325, 324], [42, 286, 41, 326, 327, 51], [79, 280, 41, 328, 321, 329], [41, 286, 79, 327, 330, 329], [43, 281, 42, 331, 332, 52], [42, 281, 80, 332, 333, 334], [80, 286, 42, 335, 326, 334], [81, 281, 43, 336, 331, 337], [43, 288, 81, 295, 296, 337], [73, 282, 74, 299, 303, 83], [74, 283, 75, 305, 308, 84], [75, 287, 76, 310, 315, 85], [76, 284, 77, 313, 320, 86], [77, 279, 78, 318, 323, 87], [78, 280, 79, 325, 328, 88], [79, 286, 80, 330, 335, 89], [80, 281, 81, 333, 336, 90]], "tetrahedron_2nd": [[339, 79, 80, 167, 363, 89, 364, 365, 215, 212], [23, 22, 339, 228, 32, 366, 367, 268, 368, 267], [56, 340, 57, 161, 369, 370, 66, 188, 189, 371], [3, 341, 54, 163, 372, 373, 63, 172, 174, 374], [41, 339, 42, 110, 375, 376, 51, 153, 158, 377], [345, 58, 221, 361, 378, 260, 379, 380, 381, 382], [19, 18, 103, 349, 28, 130, 129, 383, 384, 385], [351, 345, 221, 361, 386, 379, 387, 388, 381, 380], [345, 351, 359, 279, 386, 389, 390, 391, 392, 393], [38, 353, 103, 37, 394, 395, 137, 47, 132, 396], [76, 75, 161, 340, 85, 190, 195, 397, 371, 398], [74, 73, 164, 342, 83, 182, 185, 399, 400, 401], [2, 163, 73, 350, 171, 173, 82, 402, 403, 404], [16, 17, 342, 108, 26, 405, 406, 121, 407, 120], [58, 345, 221, 59, 378, 379, 260, 68, 265, 408], [54, 55, 342, 225, 64, 409, 410, 241, 411, 245], [23, 343, 105, 24, 412, 413, 155, 33, 154, 414], [43, 4, 102, 344, 53, 116, 118, 415, 416, 417], [348, 40, 78, 362, 418, 324, 419, 420, 421, 422], [78, 345, 77, 169, 423, 424, 87, 207, 202, 425], [78, 362, 40, 359, 421, 422, 324, 426, 427, 428], [346, 17, 18, 107, 429, 27, 430, 431, 124, 125], [346, 55, 17, 338, 432, 244, 429, 433, 434, 435], [351, 40, 39, 111, 436, 49, 437, 438, 143, 148], [39, 109, 38, 347, 142, 138, 48, 439, 440, 441], [21, 351, 40, 359, 442, 436, 146, 443, 427, 389], [352, 5, 102, 24, 444, 117, 445, 446, 119, 34], [109, 19, 347, 20, 135, 447, 441, 134, 448, 29], [80, 81, 343, 170, 90, 449, 450, 217, 451, 219], [60, 162, 59, 348, 204, 203, 69, 452, 453, 454], [22, 21, 348, 223, 31, 455, 456, 263, 457, 262], [75, 74, 165, 346, 84, 187, 192, 458, 459, 460], [359, 345, 59, 221, 390, 408, 461, 462, 265, 379], [59, 362, 78, 359, 463, 421, 206, 461, 426, 428], [348, 78, 79, 162, 419, 88, 464, 454, 210, 205], [59, 345, 78, 169, 408, 423, 206, 199, 207, 425], [345, 359, 351, 221, 390, 389, 386, 379, 387, 462], [347, 57, 19, 349, 465, 254, 447, 466, 383, 467], [352, 355, 344, 102, 468, 469, 470, 445, 416, 471], [41, 40, 348, 104, 50, 418, 472, 152, 473, 147], [36, 346, 17, 338, 474, 429, 126, 475, 434, 433], [55, 346, 74, 338, 432, 460, 186, 435, 476, 433], [0, 354, 350, 106, 477, 478, 479, 113, 480, 481], [1, 354, 106, 341, 482, 481, 112, 483, 484, 485], [6, 355, 344, 168, 486, 469, 487, 176, 488, 489], [7, 355, 168, 352, 490, 489, 175, 491, 492, 468], [21, 351, 20, 111, 442, 493, 30, 139, 140, 438], [62, 343, 170, 61, 494, 451, 214, 71, 213, 495], [58, 345, 59, 169, 378, 408, 68, 198, 199, 425], [21, 351, 221, 20, 442, 387, 258, 30, 257, 493], [360, 16, 342, 35, 496, 406, 497, 498, 499, 122], [163, 357, 341, 54, 500, 501, 374, 174, 373, 502], [344, 4, 102, 355, 417, 116, 416, 469, 471, 503], [35, 342, 36, 108, 499, 504, 45, 123, 128, 407], [346, 55, 165, 56, 432, 183, 459, 505, 184, 65], [352, 344, 355, 168, 470, 469, 468, 492, 489, 488], [54, 342, 55, 164, 410, 409, 64, 179, 180, 400], [346, 107, 37, 36, 431, 133, 506, 474, 46, 127], [350, 341, 163, 357, 507, 374, 404, 508, 500, 501], [352, 81, 344, 168, 509, 510, 470, 492, 488, 177], [61, 339, 167, 60, 511, 365, 209, 70, 208, 512], [23, 339, 22, 110, 367, 366, 32, 149, 150, 377], [279, 361, 351, 39, 513, 388, 393, 317, 437, 514], [348, 59, 21, 362, 453, 264, 455, 420, 515, 463], [340, 353, 37, 103, 516, 396, 517, 518, 132, 395], [39, 347, 77, 361, 439, 519, 319, 514, 520, 521], [349, 353, 340, 103, 522, 516, 523, 384, 518, 395], [77, 58, 345, 361, 201, 378, 424, 520, 380, 382], [60, 348, 22, 356, 452, 456, 269, 524, 525, 526], [339, 79, 167, 60, 363, 212, 365, 512, 208, 211], [22, 348, 21, 104, 456, 455, 31, 144, 145, 473], [279, 361, 39, 77, 513, 514, 317, 318, 319, 520], [347, 77, 361, 58, 519, 520, 521, 527, 382, 201], [359, 345, 279, 78, 390, 391, 392, 426, 323, 423], [60, 22, 348, 223, 269, 456, 452, 270, 457, 263], [42, 43, 105, 343, 52, 160, 157, 528, 413, 529], [348, 78, 40, 280, 419, 324, 418, 530, 322, 325], [349, 287, 340, 353, 531, 532, 523, 522, 516, 533], [59, 362, 359, 21, 463, 428, 461, 264, 443, 515], [339, 41, 79, 356, 375, 329, 363, 534, 535, 536], [62, 343, 61, 229, 494, 495, 71, 278, 276, 537], [58, 345, 169, 77, 378, 425, 198, 201, 202, 424], [40, 359, 279, 78, 427, 392, 316, 324, 323, 426], [35, 342, 108, 16, 499, 407, 123, 122, 121, 406], [74, 164, 55, 342, 185, 180, 186, 399, 409, 400], [360, 16, 35, 357, 496, 122, 498, 538, 539, 540], [360, 35, 73, 357, 498, 300, 541, 538, 542, 539], [360, 16, 357, 54, 496, 540, 538, 543, 502, 240], [347, 39, 109, 20, 439, 142, 441, 448, 134, 141], [342, 35, 73, 360, 499, 300, 401, 497, 541, 498], [341, 357, 16, 54, 501, 540, 544, 373, 240, 502], [16, 357, 341, 106, 540, 501, 544, 115, 484, 545], [352, 102, 5, 355, 445, 117, 444, 468, 546, 471], [38, 349, 103, 353, 547, 384, 137, 394, 395, 522], [342, 73, 35, 282, 401, 300, 499, 548, 298, 299], [281, 43, 42, 343, 331, 52, 332, 549, 528, 529], [61, 343, 170, 80, 495, 451, 213, 216, 217, 450], [346, 55, 56, 226, 432, 65, 505, 550, 251, 246], [107, 18, 346, 37, 124, 430, 431, 133, 506, 131], [102, 4, 5, 355, 116, 12, 117, 471, 546, 503], [80, 281, 42, 343, 333, 332, 334, 450, 528, 549], [80, 42, 339, 343, 334, 376, 364, 450, 551, 528], [17, 55, 342, 338, 244, 409, 405, 434, 552, 435], [75, 165, 56, 346, 192, 184, 191, 458, 505, 459], [348, 21, 59, 223, 455, 264, 453, 457, 266, 262], [347, 58, 227, 57, 527, 261, 553, 465, 256, 67], [60, 22, 339, 356, 269, 366, 512, 524, 534, 525], [342, 54, 73, 164, 410, 181, 401, 400, 182, 179], [38, 349, 353, 287, 547, 522, 394, 306, 533, 531], [75, 340, 287, 37, 398, 532, 310, 309, 307, 517], [166, 57, 347, 76, 193, 465, 554, 197, 555, 196], [340, 18, 349, 103, 556, 385, 523, 518, 384, 130], [37, 346, 75, 340, 506, 458, 309, 517, 398, 557], [60, 348, 79, 162, 452, 464, 211, 204, 210, 454], [356, 339, 41, 22, 534, 375, 536, 525, 151, 366], [22, 41, 348, 104, 151, 472, 456, 144, 473, 152], [347, 361, 20, 58, 521, 558, 448, 527, 259, 382], [21, 348, 40, 104, 455, 418, 146, 145, 147, 473], [348, 356, 79, 41, 526, 535, 464, 472, 329, 536], [167, 80, 339, 61, 215, 364, 365, 209, 511, 216], [110, 339, 42, 23, 377, 376, 158, 149, 156, 367], [339, 79, 41, 286, 363, 329, 375, 559, 327, 330], [42, 343, 105, 23, 528, 413, 157, 156, 155, 412], [166, 77, 347, 58, 200, 519, 554, 194, 527, 201], [166, 57, 58, 347, 193, 67, 194, 554, 527, 465], [2, 3, 163, 354, 10, 172, 171, 560, 561, 562], [339, 41, 22, 110, 375, 151, 366, 377, 150, 153], [347, 76, 349, 38, 555, 563, 466, 440, 547, 314], [59, 162, 78, 348, 203, 205, 206, 453, 419, 454], [348, 22, 356, 41, 456, 525, 526, 472, 536, 151], [347, 19, 109, 38, 447, 135, 441, 440, 138, 136], [62, 343, 358, 81, 494, 564, 565, 218, 566, 449], [351, 361, 221, 20, 388, 381, 387, 493, 257, 558], [347, 76, 57, 349, 555, 196, 465, 466, 467, 563], [343, 43, 105, 24, 529, 160, 413, 414, 154, 159], [24, 352, 358, 43, 446, 567, 568, 159, 569, 570], [344, 6, 168, 81, 487, 176, 488, 510, 177, 91], [352, 7, 62, 168, 491, 72, 571, 492, 178, 175], [354, 0, 1, 106, 477, 8, 482, 481, 112, 113], [341, 1, 16, 106, 483, 25, 544, 484, 115, 112], [1, 354, 341, 3, 482, 485, 483, 11, 372, 562], [350, 0, 106, 35, 479, 113, 480, 572, 114, 44], [355, 6, 7, 168, 486, 14, 490, 489, 175, 176], [7, 355, 352, 5, 490, 468, 491, 15, 444, 546], [280, 78, 79, 348, 325, 88, 328, 530, 464, 419], [347, 227, 58, 20, 553, 261, 527, 448, 259, 253], [361, 58, 221, 20, 382, 260, 381, 558, 257, 259], [81, 43, 343, 358, 337, 529, 449, 566, 564, 569], [21, 351, 111, 40, 442, 438, 139, 146, 148, 436], [342, 36, 338, 74, 504, 475, 552, 399, 476, 304], [106, 16, 357, 35, 115, 540, 545, 114, 539, 122], [39, 347, 361, 20, 439, 521, 514, 141, 558, 448], [60, 348, 59, 223, 452, 453, 69, 270, 266, 457], [347, 76, 38, 284, 555, 314, 440, 573, 312, 313], [17, 342, 55, 225, 405, 409, 244, 239, 245, 411], [351, 361, 20, 39, 388, 558, 493, 437, 141, 514], [343, 23, 61, 229, 412, 274, 495, 537, 276, 272], [352, 81, 62, 358, 509, 218, 571, 567, 565, 566], [352, 81, 168, 62, 509, 177, 492, 571, 178, 218], [221, 59, 359, 21, 265, 461, 462, 258, 443, 264], [74, 346, 36, 338, 460, 474, 304, 476, 475, 433], [56, 75, 346, 340, 191, 458, 505, 369, 557, 398], [75, 340, 56, 161, 398, 369, 191, 190, 188, 371], [340, 18, 103, 37, 556, 130, 518, 517, 132, 131], [24, 62, 343, 358, 277, 494, 414, 568, 564, 565], [340, 287, 37, 353, 532, 307, 517, 516, 396, 533], [24, 352, 62, 358, 446, 571, 277, 568, 565, 567], [21, 351, 359, 221, 442, 389, 443, 258, 462, 387], [339, 23, 228, 61, 367, 268, 368, 511, 275, 274], [343, 42, 339, 23, 528, 376, 551, 412, 367, 156], [57, 340, 76, 161, 370, 397, 196, 189, 195, 371], [349, 38, 76, 287, 547, 314, 563, 531, 315, 306], [24, 352, 43, 102, 446, 570, 159, 119, 118, 445], [59, 362, 348, 78, 463, 420, 453, 206, 419, 421], [352, 81, 358, 43, 509, 566, 567, 570, 569, 337], [359, 362, 40, 21, 428, 422, 427, 443, 146, 515], [347, 166, 76, 77, 554, 197, 555, 519, 86, 200], [347, 19, 57, 227, 447, 254, 465, 553, 256, 252], [3, 341, 163, 354, 372, 374, 172, 562, 561, 485], [347, 77, 76, 284, 519, 86, 555, 573, 313, 320], [355, 7, 6, 97, 490, 14, 486, 574, 100, 101], [344, 6, 288, 4, 487, 293, 575, 417, 294, 13], [354, 1, 0, 92, 482, 8, 477, 576, 93, 94], [2, 3, 354, 92, 10, 562, 560, 95, 576, 96], [1, 354, 3, 92, 482, 562, 11, 94, 96, 576], [355, 4, 5, 97, 503, 12, 546, 574, 98, 99], [7, 355, 5, 97, 490, 546, 15, 101, 98, 574], [350, 0, 285, 2, 479, 289, 577, 402, 290, 9], [37, 346, 283, 75, 506, 578, 301, 309, 308, 458], [36, 17, 346, 107, 126, 429, 474, 127, 431, 125], [346, 17, 55, 226, 429, 244, 432, 550, 246, 242], [80, 81, 281, 343, 90, 336, 333, 450, 549, 449], [163, 357, 54, 73, 500, 502, 174, 173, 181, 542], [55, 74, 346, 165, 186, 460, 432, 183, 459, 187], [74, 36, 346, 283, 304, 474, 460, 305, 578, 302], [38, 287, 353, 37, 306, 533, 394, 47, 396, 307], [286, 79, 80, 339, 330, 89, 335, 559, 364, 363], [61, 80, 339, 343, 216, 364, 511, 495, 551, 450], [73, 35, 285, 350, 300, 291, 292, 403, 577, 572], [75, 74, 346, 283, 84, 460, 458, 308, 578, 305], [56, 222, 57, 340, 250, 255, 66, 369, 370, 579], [37, 18, 346, 340, 131, 430, 506, 517, 557, 556], [350, 341, 357, 106, 507, 501, 508, 480, 545, 484], [24, 62, 352, 220, 277, 571, 446, 236, 580, 237], [340, 18, 56, 222, 556, 249, 369, 579, 250, 247], [3, 224, 54, 341, 230, 233, 63, 372, 373, 581], [352, 7, 220, 62, 491, 235, 580, 571, 237, 72], [350, 0, 35, 285, 479, 44, 572, 577, 291, 289], [341, 1, 3, 224, 483, 11, 372, 581, 230, 231], [74, 73, 342, 282, 83, 401, 399, 303, 548, 299], [342, 36, 74, 282, 504, 304, 399, 548, 303, 297], [62, 343, 81, 170, 494, 449, 218, 214, 219, 451], [60, 339, 22, 228, 512, 366, 269, 271, 267, 368], [360, 54, 73, 342, 543, 181, 541, 497, 401, 410], [23, 229, 343, 24, 272, 537, 412, 33, 414, 273], [39, 77, 347, 284, 319, 519, 439, 311, 573, 320], [36, 342, 17, 108, 504, 405, 126, 128, 120, 407], [24, 343, 62, 229, 414, 494, 277, 273, 278, 537], [43, 4, 344, 288, 53, 417, 415, 295, 575, 294], [6, 355, 97, 4, 486, 574, 100, 13, 99, 503], [80, 42, 286, 339, 334, 326, 335, 364, 559, 376], [6, 355, 4, 344, 486, 503, 13, 487, 417, 469], [78, 279, 77, 345, 323, 318, 87, 423, 424, 391], [41, 40, 280, 348, 50, 322, 321, 472, 530, 418], [59, 345, 359, 78, 408, 390, 461, 206, 426, 423], [226, 17, 18, 346, 242, 27, 243, 550, 430, 429], [35, 342, 282, 36, 499, 548, 298, 45, 297, 504], [350, 341, 354, 163, 507, 485, 478, 404, 561, 374], [346, 56, 18, 226, 505, 249, 430, 550, 243, 251], [279, 361, 345, 351, 513, 380, 391, 393, 386, 388], [39, 347, 38, 284, 439, 440, 48, 311, 312, 573], [20, 351, 39, 111, 493, 437, 141, 140, 143, 438], [18, 56, 346, 340, 249, 505, 430, 556, 557, 369], [41, 286, 42, 339, 327, 326, 51, 375, 376, 559], [60, 79, 348, 356, 211, 464, 452, 524, 526, 535], [280, 348, 79, 41, 530, 464, 328, 321, 329, 472], [21, 362, 40, 348, 515, 422, 146, 455, 418, 420], [23, 61, 339, 343, 274, 511, 367, 412, 551, 495], [61, 339, 60, 228, 511, 512, 70, 275, 271, 368], [339, 79, 60, 356, 363, 211, 512, 534, 524, 535], [352, 344, 43, 102, 470, 415, 570, 445, 118, 416], [19, 18, 349, 222, 28, 385, 383, 248, 582, 247], [57, 349, 340, 222, 467, 523, 370, 255, 579, 582], [340, 18, 222, 349, 556, 247, 579, 523, 582, 385], [57, 349, 222, 19, 467, 582, 255, 254, 248, 383], [352, 81, 43, 344, 509, 337, 570, 470, 415, 510], [349, 287, 76, 340, 531, 315, 563, 523, 397, 532], [341, 1, 224, 16, 483, 231, 581, 544, 232, 25], [16, 341, 54, 224, 544, 373, 240, 232, 233, 581], [76, 75, 340, 287, 85, 398, 397, 315, 532, 310], [338, 342, 74, 55, 552, 399, 476, 435, 186, 409], [350, 357, 163, 73, 508, 500, 404, 403, 173, 542], [57, 349, 76, 340, 467, 563, 196, 370, 397, 523], [2, 350, 73, 285, 402, 403, 82, 290, 292, 577], [0, 354, 92, 2, 477, 576, 93, 9, 95, 560], [342, 17, 338, 36, 405, 434, 552, 504, 475, 126], [0, 354, 2, 350, 477, 560, 9, 479, 402, 478], [16, 17, 225, 342, 26, 239, 238, 406, 411, 405], [350, 341, 106, 354, 507, 484, 480, 478, 481, 485], [38, 349, 19, 103, 547, 383, 136, 137, 129, 384], [54, 16, 225, 342, 240, 238, 241, 410, 411, 406], [350, 357, 35, 106, 508, 539, 572, 480, 114, 545], [354, 163, 2, 350, 561, 171, 560, 478, 402, 404], [344, 6, 81, 288, 487, 91, 510, 575, 296, 293], [344, 81, 43, 288, 510, 337, 415, 575, 295, 296], [279, 40, 39, 351, 316, 49, 317, 393, 437, 436], [40, 359, 351, 279, 427, 389, 436, 316, 393, 392], [279, 361, 77, 345, 513, 520, 318, 391, 424, 380], [54, 357, 360, 73, 502, 538, 543, 181, 541, 542], [360, 16, 54, 342, 496, 240, 543, 497, 410, 406], [346, 36, 37, 283, 474, 46, 506, 578, 301, 302], [35, 357, 350, 73, 539, 508, 572, 300, 403, 542], [220, 5, 352, 24, 234, 444, 580, 236, 446, 34], [81, 343, 43, 281, 449, 529, 337, 336, 331, 549], [358, 343, 24, 43, 564, 414, 568, 569, 159, 529], [352, 7, 5, 220, 491, 15, 444, 580, 234, 235], [347, 19, 227, 20, 447, 252, 553, 448, 253, 29], [347, 349, 19, 38, 466, 383, 447, 440, 136, 547]], "line_2nd": [[1, 0, 8], [0, 2, 9], [3, 2, 10], [1, 3, 11], [5, 4, 12], [4, 6, 13], [7, 6, 14], [5, 7, 15], [1, 16, 25], [16, 17, 26], [17, 18, 27], [18, 19, 28], [19, 20, 29], [20, 21, 30], [21, 22, 31], [22, 23, 32], [23, 24, 33], [24, 5, 34], [0, 35, 44], [35, 36, 45], [36, 37, 46], [37, 38, 47], [38, 39, 48], [39, 40, 49], [40, 41, 50], [41, 42, 51], [42, 43, 52], [43, 4, 53], [3, 54, 63], [54, 55, 64], [55, 56, 65], [56, 57, 66], [57, 58, 67], [58, 59, 68], [59, 60, 69], [60, 61, 70], [61, 62, 71], [62, 7, 72], [2, 73, 82], [73, 74, 83], [74, 75, 84], [75, 76, 85], [76, 77, 86], [77, 78, 87], [78, 79, 88], [79, 80, 89], [80, 81, 90], [81, 6, 91]]}, "num_vertices": 583, "num_faces": 168, "num_cells": 494, "mesh_dimension": 3};
        window.meshData = fullMeshData;
        
        // Set cells data from template
        window.cells = fullMeshData.cells || {};
        window.faces = fullMeshData.faces || [];
        
        // Debug: Log cells data
        console.log('=== MESH DATA DEBUG ===');
        console.log('Vertices:', fullMeshData.vertices ? fullMeshData.vertices.length : 'undefined');
        console.log('Faces:', window.faces.length);
        console.log('Cells:', window.cells);
        console.log('Cells type:', typeof window.cells);
        console.log('Cells keys:', Object.keys(window.cells));
        
        // Debug all available cell types
        Object.keys(window.cells).forEach(cellType => {
            console.log(`${cellType}:`, window.cells[cellType].length, 'elements');
        });
        
        // Field data removed from mesh preview
        
        // Configure controls based on mesh dimension
        function configureControlsForDimension() {
            const surfaceOption = document.getElementById('surface-option');
            const surfaceViewBtn = document.getElementById('surface-view-btn');
            const volumeViewBtn = document.getElementById('volume-view-btn');
            const representationSelect = document.getElementById('representation-select');
            
            console.log('Mesh dimension:', meshDimension);
            console.log('Surface button found:', !!surfaceViewBtn);
            console.log('Volume button found:', !!volumeViewBtn);
            
            if (meshDimension === 1) {
                // 1D meshes: Only points and wireframe, no surface/volume buttons
                if (surfaceViewBtn) {
                    surfaceViewBtn.style.display = 'none';
                    console.log('Hidden surface button for 1D mesh');
                }
                if (volumeViewBtn) {
                    volumeViewBtn.style.display = 'none';
                    console.log('Hidden volume button for 1D mesh');
                }
                // Hide surface option in representation select
                if (surfaceOption) {
                    surfaceOption.style.display = 'none';
                    console.log('Hidden surface option for 1D mesh');
                }
            } else if (meshDimension === 2) {
                // 2D meshes: Points, wireframe, surface - no volume button
                if (surfaceViewBtn) {
                    surfaceViewBtn.style.display = 'none';
                    console.log('Hidden surface button for 2D mesh (use representation select)');
                }
                if (volumeViewBtn) {
                    volumeViewBtn.style.display = 'none';
                    console.log('Hidden volume button for 2D mesh');
                }
                // Show surface option in representation select
                if (surfaceOption) {
                    surfaceOption.style.display = 'block';
                    console.log('Shown surface option for 2D mesh');
                }
            } else if (meshDimension === 3) {
                // 3D meshes: Full functionality - show all buttons
                if (surfaceViewBtn) {
                    surfaceViewBtn.style.display = 'inline-block';
                    console.log('Shown surface button for 3D mesh');
                }
                if (volumeViewBtn) {
                    volumeViewBtn.style.display = 'inline-block';
                    console.log('Shown volume button for 3D mesh');
                }
                // Show surface option in representation select
                if (surfaceOption) {
                surfaceOption.style.display = 'block';
                    console.log('Shown surface option for 3D mesh');
                }
            }
            
            // No field configuration in mesh preview - use field_visualization.html for field visualization
            
            // Dimension-specific configuration handled above
            
        }
        
        // Make functions globally accessible immediately
        function fitToView() {
            console.log('*** FIT TO VIEW CLICKED ***');
            console.log('Renderer available:', !!window.renderer);
            console.log('Actor available:', !!window.actor);
            console.log('RenderWindow available:', !!window.renderWindow);
            
            if (window.renderer && window.actor && window.renderWindow) {
                window.renderer.resetCamera();
                window.renderWindow.render();
                console.log('Camera reset to fit mesh');
                        } else {
                console.log('VTK objects not available for fit to view');
                console.log('Renderer:', window.renderer);
                console.log('Actor:', window.actor);
                console.log('RenderWindow:', window.renderWindow);
            }
        }
        
        function showSurfaceView() {
            console.log('*** SURFACE VIEW TOGGLE CLICKED ***');
            console.log('Switching to surface view');
            
            // Check if we have surface elements available
            if (!window.cells || Object.keys(window.cells).length === 0) {
                console.log('No surface elements available');
                alert('No surface elements found in this mesh. Cells data: ' + JSON.stringify(window.cells));
                return;
            }
            
            // Update button states
            updateViewButtonStates();
            
            // Get current representation and recreate mesh with surface elements only
            const representationSelect = document.getElementById('representation-select');
            const currentRepresentation = representationSelect ? parseInt(representationSelect.value) : 2;
            createUnifiedMeshWithRepresentation(currentRepresentation, 'surface');
            
            console.log('Switched to surface view mode');
        }
        
        function showVolumeView() {
            console.log('*** VOLUME VIEW TOGGLE CLICKED ***');
            console.log('Cells data:', window.cells);
            
            if (!window.cells || Object.keys(window.cells).length === 0) {
                console.log('No volume elements available');
                alert('No volume elements found in this mesh. Cells data: ' + JSON.stringify(window.cells));
                return;
            }
            
            console.log('Switching to volume view');
            
            // Update button states
            updateViewButtonStates();
            
            // Get current representation and recreate mesh with volume elements
            const representationSelect = document.getElementById('representation-select');
            const currentRepresentation = representationSelect ? parseInt(representationSelect.value) : 2;
            createUnifiedMeshWithRepresentation(currentRepresentation, 'volume');
            
            // Log details about each cell type
            for (const [cellType, cellData] of Object.entries(window.cells)) {
                console.log(`${cellType}: ${cellData ? cellData.length : 0} elements`);
                if (cellData && cellData.length > 0) {
                    console.log(`Sample ${cellType}:`, cellData[0]);
                }
            }
            
            console.log('Switched to volume view mode');
        }
        
        function changeRepresentation(value) {
            console.log('*** REPRESENTATION CHANGED TO:', value, '***');
            console.log('Mesh dimension:', meshDimension);
            
            const repValue = parseInt(value);
            
            if (meshDimension === 1) {
                // For 1D meshes, handle points and wireframe representations only
                if (window.actor && window.renderWindow) {
                    // No field actors in mesh preview
                        
                    // No colorbar in mesh preview
                        
                        if (repValue === 0) {
                            // Points representation
                        console.log('Setting 1D mesh to points representation');
                        const actorProps = window.actor.getProperty();
                            actorProps.setRepresentation(0); // Points
                            actorProps.setPointSize(8); // Large points for visibility
                            actorProps.setLineWidth(1); // Reset line width
                        } else if (repValue === 1) {
                        // Wireframe representation - recreate mesh with proper line connectivity
                        console.log('Creating 1D wireframe mesh...');
                        create1DMesh();
                    }
                    
                    // Force render
                        window.renderWindow.render();
                }
            } else if (meshDimension === 2) {
                // For 2D meshes, handle points, wireframe, surface, and field representations
                if (window.actor && window.renderWindow) {
                    // Field representation removed from mesh preview
                    {
                        // No field actors in mesh preview
                        
                        // No colorbar in mesh preview
                        
                        // Points, wireframe, or surface representation
                        const actorProps = window.actor.getProperty();
                        
                        if (repValue === 0) {
                            // Points representation
                            actorProps.setRepresentation(0); // Points
                            actorProps.setPointSize(5);
                            actorProps.setLineWidth(1);
                            actorProps.setEdgeVisibility(false);
                        } else if (repValue === 1) {
                            // Wireframe representation
                            actorProps.setRepresentation(1); // Wireframe
                            // Don't set color - preserve default wireframe color
                        } else if (repValue === 2) {
                            // Surface representation
                            actorProps.setRepresentation(2); // Surface
                            actorProps.setOpacity(0.8);
                            actorProps.setPointSize(1);
                            actorProps.setLineWidth(1);
                            actorProps.setEdgeVisibility(true); // Show edges on surface
                            actorProps.setColor(0, 1, 0); // Green surface
                        }
                        
                        // Don't reset camera - keep current camera position
                        window.renderWindow.render();
                    }
                }
            } else if (meshDimension === 3) {
                // For 3D meshes, handle points, wireframe, surface, and field representations
                if (window.actor && window.renderWindow) {
                    // Field representation removed from mesh preview
                    {
                        // No field actors in mesh preview
                        
                        // No colorbar in mesh preview
                        
                        // Points, wireframe, or surface representation
                        const actorProps = window.actor.getProperty();
                        
                        if (repValue === 0) {
                            // Points representation
                            actorProps.setRepresentation(0); // Points
                            actorProps.setPointSize(3);
                            actorProps.setColor(0, 1, 0); // Green
                        } else if (repValue === 1) {
                            // Wireframe representation
                            actorProps.setRepresentation(1); // Wireframe
                            actorProps.setLineWidth(2);
                            actorProps.setEdgeVisibility(true);
                            // Don't set color - preserve default wireframe color
                        } else if (repValue === 2) {
                            // Surface representation
                            actorProps.setRepresentation(2); // Surface
                            actorProps.setOpacity(0.8);
                            actorProps.setColor(0, 1, 0); // Green
                            actorProps.setEdgeVisibility(true);
                            actorProps.setLineWidth(1);
                        }
                        
                        // Don't reset camera - keep current camera position
                        window.renderWindow.render();
                    }
                }
            } else {
                createMeshWithCurrentMode(repValue);
            }
            
            console.log('Representation changed to:', value);
        }
        
        // Field visualization removed from mesh preview - use field_visualization.html instead
        
        function changeBackground(color) {
            console.log('*** BACKGROUND CHANGED TO:', color, '***');
            if (window.renderer) {
                const r = parseInt(color.substr(1, 2), 16) / 255;
                const g = parseInt(color.substr(3, 2), 16) / 255;
                const b = parseInt(color.substr(5, 2), 16) / 255;
                window.renderer.setBackground(r, g, b);
                window.renderWindow.render();
                console.log('Background changed to:', color);
            } else {
                console.log('Renderer not available for background change');
            }
        }
        
        function createMeshWithCurrentMode(representation) {
            if (window.actor && window.renderWindow) {
                // Remove current actor
                window.renderer.removeActor(window.actor);
                
                // Create new mesh based on current mode and representation
                if (meshDimension === 1) {
                    // For 1D meshes, use current representation setting
                    const representationSelect = document.getElementById('representation-select');
                    const currentRepresentation = representationSelect ? parseInt(representationSelect.value) : 1;
                    createUnifiedMeshWithRepresentation(currentRepresentation, 'surface');
                } else if (meshDimension === 2) {
                    // For 2D meshes, use the 2D mesh creation function
                    create2DMesh();
                } else {
                    // Default to surface mode for mesh preview
                    createUnifiedMeshWithRepresentation(representation, 'surface');
                }
                
                window.renderWindow.render();
            } else {
                console.log('VTK objects not available for mesh creation');
            }
        }
        
        function updateViewButtonStates() {
            // Simplified button state management for mesh preview
            const surfaceButton = document.getElementById('surface-view-btn');
            const volumeButton = document.getElementById('volume-view-btn');
            
            if (surfaceButton && volumeButton) {
                // Default styling for mesh preview
                    surfaceButton.style.backgroundColor = '#001100';
                    surfaceButton.style.color = '#00ff00';
                surfaceButton.style.border = '1px solid #00ff00';
                    volumeButton.style.backgroundColor = '#001100';
                    volumeButton.style.color = '#00ff00';
                volumeButton.style.border = '1px solid #00ff00';
            }
        }
        
        // Make functions globally accessible
        window.fitToView = fitToView;
        window.showSurfaceView = showSurfaceView;
        window.showVolumeView = showVolumeView;
        window.changeRepresentation = changeRepresentation;
        // changeField removed from mesh preview
        window.changeBackground = changeBackground;
        
        // Test functions removed from mesh preview
        
        // Duplicate data assignments removed
        
        // Field data debugging removed
        
        // Mesh preview doesn't need field tracking
        
                const meshData = window.meshData.vertices || window.meshData;
                const faces = window.meshData.faces || window.faces;
                const cells = window.meshData.cells || window.cells;
        const settings = window.settings;
        
                console.log('Starting VTK.js visualization...');
                console.log('Mesh data:', meshData);
                console.log('Faces:', faces);
                console.log('Cells:', cells);
                console.log('Settings:', settings);
                
                // Debug: Check what volume elements we have
                if (cells) {
                    console.log('Available cell types:', Object.keys(cells));
                    for (const [cellType, cellData] of Object.entries(cells)) {
                        console.log(`${cellType}: ${cellData ? cellData.length : 0} elements`);
                            }
                } else {
                    console.log('No cells data available');
                }
        
        let vtk, fullScreenRenderer;
        window.renderer = null;
        window.renderWindow = null;
        window.actor = null;
        let mapper;
        let isVolumeMode = false;
        let originalMeshData = null;
        
        
        
        // Test if functions are accessible on page load
        console.log('Page loaded, testing function accessibility:');
        console.log('fitToView function:', typeof fitToView);
        console.log('window.fitToView function:', typeof window.fitToView);
        
        // Test if onclick handlers work at all
        console.log('Testing onclick handler accessibility...');
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, testing button access...');
            
            // Configure controls based on mesh dimension
            configureControlsForDimension();
            
            const fitButton = document.getElementById('fit-view');
            const surfaceButton = document.getElementById('surface-view-btn');
            const volumeButton = document.getElementById('volume-view-btn');
            console.log('Fit button found:', !!fitButton);
            console.log('Surface button found:', !!surfaceButton);
            console.log('Volume button found:', !!volumeButton);
            
            if (fitButton) {
                console.log('Fit button onclick:', fitButton.onclick);
                console.log('Fit button has onclick attribute:', fitButton.hasAttribute('onclick'));
                
                // Add event listeners as backup
                fitButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Fit button clicked via addEventListener!');
                    fitToView();
                });
                
                surfaceButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Surface button clicked via addEventListener!');
                    showSurfaceView();
                });
                
                volumeButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Volume button clicked via addEventListener!');
                    showVolumeView();
                });
                
                console.log('Added event listeners to all buttons');
            }
        });
        
        // Wait for VTK.js to load
        window.addEventListener('load', function() {
            setTimeout(function() {
                try {
                    vtk = window.vtk;
                    console.log('VTK loaded:', !!vtk);
                        
                        if (vtk) {
                        console.log('VTK object keys:', Object.keys(vtk));
                                initVTK();
                } else {
                        console.error('VTK.js not available in window.vtk');
                    }
                } catch (error) {
                    console.error('VTK check error:', error);
                }
            }, 100); // Small delay to ensure script is loaded
        });
        
        function initVTK() {
            try {
                console.log('Initializing VTK.js...');
                
                // Create render window and attach to VTK container only
                window.vtkContainer = document.getElementById('vtk-container');
                const mainContainer = document.getElementById('container');
                window.renderWindow = vtk.Rendering.Core.vtkRenderWindow.newInstance();
                renderWindow = window.renderWindow;
                
                // Create OpenGL render window and attach to VTK container only
                const openGLRenderWindow = vtk.Rendering.OpenGL.vtkRenderWindow.newInstance();
                openGLRenderWindow.setContainer(window.vtkContainer);
                
                // Enable high-quality rendering (using supported methods)
                openGLRenderWindow.setUseOffScreen(false);
                openGLRenderWindow.setSize(window.vtkContainer.clientWidth, window.vtkContainer.clientHeight);
                
                console.log('VTK container attached to render window');
                console.log('VTK container size:', window.vtkContainer.clientWidth, 'x', window.vtkContainer.clientHeight);
                console.log('VTK container element:', window.vtkContainer);
                
                renderWindow.addView(openGLRenderWindow);
                
                // Create renderer
                window.renderer = vtk.Rendering.Core.vtkRenderer.newInstance();
                renderWindow.addRenderer(window.renderer);
                renderer = window.renderer;
                
                console.log('Renderer created and assigned to window:', !!window.renderer);
                
                // Create interactor with mouse controls - bind only to VTK container
                const interactor = vtk.Rendering.Core.vtkRenderWindowInteractor.newInstance();
                interactor.setView(openGLRenderWindow);
                interactor.initialize();
                interactor.bindEvents(window.vtkContainer);
                
                // Set up mouse controls
                interactor.setInteractorStyle(vtk.Interaction.Style.vtkInteractorStyleTrackballCamera.newInstance());
                
                console.log('Interactor created and configured for mouse controls');
                console.log('Mouse controls enabled - Left: Rotate, Middle: Pan, Right: Zoom, Wheel: Zoom');
                
                // Create mesh
                createMesh();
                
                // Update button states
                updateViewButtonStates();
                
                // Controls are now handled by onclick handlers in HTML
                
                // Update info
                updateInfo();
                
                // Hide loading
                document.getElementById('loading').style.display = 'none';
                
                // Render
                renderWindow.render();
                
                // Force a second render after a short delay to ensure visibility
                setTimeout(() => {
                    renderWindow.render();
                    console.log('Second render completed');
                    
                    // Field selection logic removed from mesh preview
                }, 100);
                
                console.log('VTK.js visualization initialized successfully');
                
                // Ensure 1D mesh buttons are hidden after initialization
                if (meshDimension === 1) {
                    setTimeout(() => {
                        const surfaceBtn = document.getElementById('surface-view-btn');
                        const volumeBtn = document.getElementById('volume-view-btn');
                        if (surfaceBtn) surfaceBtn.style.display = 'none';
                        if (volumeBtn) volumeBtn.style.display = 'none';
                        console.log('Ensured 1D mesh buttons are hidden');
                    }, 100);
                }
                
            } catch (error) {
                console.error('VTK initialization error:', error);
            }
        }
        
        function createMesh() {
            try {
                console.log('Creating mesh from data...');
                console.log('Mesh dimension:', meshDimension);
                
                if (!window.meshData || window.meshData.length === 0) {
                    console.error('No mesh data available');
                    return;
                }
                
                // Handle 1D meshes differently
                if (meshDimension === 1) {
                    // Use current representation setting for 1D meshes
                    const representationSelect = document.getElementById('representation-select');
                    const currentRepresentation = representationSelect ? parseInt(representationSelect.value) : 1;
                    createUnifiedMeshWithRepresentation(currentRepresentation, 'surface');
                    return;
                }
                
                // Handle 2D meshes differently
                if (meshDimension === 2) {
                    create2DMesh();
                    return;
                }
                
                // For 3D meshes, create initial mesh based on current mode
                const representationSelect = document.getElementById('representation-select');
                const currentRepresentation = representationSelect ? parseInt(representationSelect.value) : 2;
                
                // Create initial mesh - default to surface mode for mesh preview
                    createUnifiedMeshWithRepresentation(currentRepresentation, 'surface');
                
            } catch (error) {
                console.error('Mesh creation error:', error);
            }
        }
        
        function setupControls() {
            console.log('Setting up controls...');
            console.log('Actor available:', !!actor);
            console.log('Renderer available:', !!renderer);
            console.log('RenderWindow available:', !!renderWindow);
            
            // Representation selector (following VTK.js docs pattern)
            const representationSelector = document.getElementById('representation-select');
            console.log('Representation selector found:', !!representationSelector);
            if (representationSelector) {
                representationSelector.addEventListener('change', (e) => {
                    console.log('Representation changed to:', e.target.value);
                if (actor) {
                        const newRepValue = Number(e.target.value);
                        actor.getProperty().setRepresentation(newRepValue);
                    renderWindow.render();
                        console.log('Changed representation to:', e.target.options[e.target.selectedIndex].text);
                } else {
                        console.error('Actor not available for representation change');
                }
            });
            }
            
            // Background color selector
            const backgroundSelector = document.getElementById('background-select');
            if (backgroundSelector) {
                backgroundSelector.addEventListener('change', (e) => {
                    const color = e.target.value;
                    const r = parseInt(color.substr(1, 2), 16) / 255;
                    const g = parseInt(color.substr(3, 2), 16) / 255;
                    const b = parseInt(color.substr(5, 2), 16) / 255;
                    renderer.setBackground(r, g, b);
                    renderWindow.render();
                    console.log('Changed background to:', color);
                });
            }
        }
        
        
        function create1DMesh() {
            try {
                console.log('Creating 1D mesh...');
                
                // Remove existing actor if it exists
                if (window.actor) {
                    window.renderer.removeActor(window.actor);
                    window.actor = null;
                }
                
                if (!window.meshData || (window.meshData.vertices ? window.meshData.vertices.length === 0 : window.meshData.length === 0)) {
                    console.error('No mesh data available for 1D mesh');
                    return;
                }
                
                // Create polydata for 1D mesh
                const polydata = vtk.Common.DataModel.vtkPolyData.newInstance();
                const points = vtk.Common.Core.vtkPoints.newInstance();
                const cellArray = vtk.Common.Core.vtkCellArray.newInstance();
                
                // Set vertices
                let vertices;
                const meshData = window.meshData.vertices || window.meshData;
                
                // Debug: Check the actual data structure
                console.log('Mesh data structure:', meshData);
                console.log('Mesh data length:', meshData ? meshData.length : 'undefined');
                console.log('First element:', meshData ? meshData[0] : 'undefined');
                console.log('Is first element array:', Array.isArray(meshData ? meshData[0] : null));
                
                // Handle vertices correctly - they should be in [x,y,z] format
                if (Array.isArray(meshData) && meshData.length > 0 && Array.isArray(meshData[0])) {
                    // Vertices are in [x,y,z] format - flatten them
                    vertices = meshData.flat();
                    console.log('Vertices in [x,y,z] format, flattened to:', vertices.length / 3, 'vertices');
                } else if (Array.isArray(meshData) && meshData.length > 0) {
                    // Vertices are already flattened
                    vertices = meshData;
                    console.log('Vertices already flattened:', vertices.length / 3, 'vertices');
                } else {
                    console.error('Invalid mesh data structure');
                    return;
                }
                
                points.setData(new Float32Array(vertices), 3);
                polydata.setPoints(points);
                
                // Create line elements from cells (1D elements)
                const lineElements = [];
                console.log('Available cell types:', window.cells ? Object.keys(window.cells) : 'no cells');
                
                if (window.cells && window.cells.line_2nd && window.cells.line_2nd.length > 0) {
                    // Use cells.line_2nd for 1D connectivity (quadratic elements)
                    console.log('Using line_2nd cells:', window.cells.line_2nd.length);
                    for (let i = 0; i < window.cells.line_2nd.length; i++) {
                        const line = window.cells.line_2nd[i];
                        if (Array.isArray(line) && line.length >= 2) {
                        if (line.length === 2) {
                            // Linear line element
                            lineElements.push(line);
                        } else if (line.length === 3) {
                            // Quadratic line element - create two line segments for proper wireframe
                            lineElements.push([line[0], line[1]]); // First segment
                            lineElements.push([line[1], line[2]]); // Second segment
                        }
                        }
                    }
                } else if (window.cells && window.cells.line && window.cells.line.length > 0) {
                    // Use cells.line for 1D connectivity (linear elements)
                    console.log('Using line cells:', window.cells.line.length);
                    for (let i = 0; i < window.cells.line.length; i++) {
                        const line = window.cells.line[i];
                        if (Array.isArray(line) && line.length >= 2) {
                            lineElements.push(line);
                        }
                    }
                } else if (window.faces && window.faces.length > 0) {
                    // Fallback to faces if cells.line not available
                    for (let i = 0; i < window.faces.length; i++) {
                        const face = window.faces[i];
                        if (Array.isArray(face) && face.length >= 2) {
                            if (face.length === 2) {
                                // Line element
                                lineElements.push(face);
                            } else if (face.length > 2) {
                                // Split into line segments
                                for (let j = 0; j < face.length; j++) {
                                    const next = (j + 1) % face.length;
                                    lineElements.push([face[j], face[next]]);
                                }
                            }
                        }
                    }
                }
                
                // Add line elements to polydata
                console.log('Adding line elements to polydata:', lineElements.length);
                for (let i = 0; i < lineElements.length; i++) {
                    cellArray.insertNextCell(lineElements[i]);
                    console.log(`Line ${i}:`, lineElements[i]);
                }
                polydata.setLines(cellArray);
                
                console.log('Polydata created with', polydata.getNumberOfPoints(), 'points and', polydata.getNumberOfCells(), 'cells');
                
                // Create mapper and actor
                const mapper = vtk.Rendering.Core.vtkMapper.newInstance();
                mapper.setInputData(polydata);
                
                const actor = vtk.Rendering.Core.vtkActor.newInstance();
                actor.setMapper(mapper);
                
                // Set actor properties for 1D mesh
                const actorProps = actor.getProperty();
                actorProps.setRepresentation(1); // Wireframe
                actorProps.setLineWidth(15); // Very thick lines for visibility
                // Keep default green color for mesh preview
                
                console.log('Set 1D mesh wireframe with thick lines');
                console.log('Line elements created:', lineElements.length);
                console.log('Actor representation:', actorProps.getRepresentation());
                console.log('Actor line width:', actorProps.getLineWidth());
                console.log('Actor color:', actorProps.getColor());
                
                // Add actor to renderer
                window.renderer.addActor(actor);
                window.actor = actor;
                
                // Set up camera for 1D mesh
                const camera = window.renderer.getActiveCamera();
                const bounds = polydata.getBounds();
                const center = [
                    (bounds[0] + bounds[1]) / 2,
                    (bounds[2] + bounds[3]) / 2,
                    (bounds[4] + bounds[5]) / 2
                ];
                
                // Position camera above the mesh center
                camera.setPosition(center[0], center[1], center[2] + 2); // Position camera above the mesh center
                camera.setFocalPoint(center[0], center[1], center[2]); // Look at center of the mesh
                camera.setViewUp(0, 1, 0); // Y-axis up
                
                // Force render
                window.renderWindow.render();
                
                // Debug: Check if mesh is visible
                console.log('=== 1D MESH DEBUG ===');
                console.log('Actor visible:', actor.getVisibility());
                console.log('Actor bounds:', actor.getBounds());
                console.log('Polydata bounds:', polydata.getBounds());
                console.log('Camera position:', camera.getPosition());
                console.log('Camera focal point:', camera.getFocalPoint());
                console.log('Renderer bounds:', window.renderer.computeVisiblePropBounds());
                
                console.log('1D mesh camera positioned at:', camera.getPosition());
                console.log('1D mesh camera looking at:', camera.getFocalPoint());
                console.log(`1D mesh created with ${vertices.length / 3} vertices and ${lineElements.length} line elements`);
            } catch (error) {
                console.error('1D mesh creation error:', error);
            }
        }

        function create2DMesh() {
            try {
                console.log('Creating 2D mesh...');
                
                if (!window.meshData || (window.meshData.vertices ? window.meshData.vertices.length === 0 : window.meshData.length === 0)) {
                    console.error('No mesh data available for 2D mesh');
                    return;
                }
                
                // Create polydata for 2D mesh
                const polydata = vtk.Common.DataModel.vtkPolyData.newInstance();
                const points = vtk.Common.Core.vtkPoints.newInstance();
                const cellArray = vtk.Common.Core.vtkCellArray.newInstance();
                
                // Set vertices
                let vertices;
                const meshData = window.meshData.vertices || window.meshData;
                
                // Handle vertices correctly - they should be in [x,y,z] format
                if (Array.isArray(meshData) && meshData.length > 0 && Array.isArray(meshData[0])) {
                    // Vertices are in [x,y,z] format - flatten them
                    vertices = meshData.flat();
                    console.log('2D mesh: Vertices in [x,y,z] format, flattened to:', vertices.length / 3, 'vertices');
                } else if (Array.isArray(meshData) && meshData.length > 0) {
                    // Vertices are already flattened
                    vertices = meshData;
                    console.log('2D mesh: Vertices already flattened:', vertices.length / 3, 'vertices');
                } else {
                    console.error('Invalid mesh data structure for 2D mesh');
                    return;
                }
                
                points.setData(new Float32Array(vertices), 3);
                polydata.setPoints(points);
                
                // Add faces to polydata
                if (window.faces && window.faces.length > 0) {
                    for (let i = 0; i < window.faces.length; i++) {
                        const face = window.faces[i];
                        if (Array.isArray(face) && face.length >= 3) {
                            if (face.length === 3) {
                                cellArray.insertNextCell(face);
                            } else if (face.length === 4) {
                                // Split quad into two triangles
                                cellArray.insertNextCell([face[0], face[1], face[2]]);
                                cellArray.insertNextCell([face[0], face[2], face[3]]);
                            }
                        }
                    }
                }
                polydata.setPolys(cellArray);
                
                // Create mapper and actor
                const mapper = vtk.Rendering.Core.vtkMapper.newInstance();
                mapper.setInputData(polydata);
                
                const actor = vtk.Rendering.Core.vtkActor.newInstance();
                actor.setMapper(mapper);
                
                // Set actor properties for 2D mesh
                const actorProps = actor.getProperty();
                actorProps.setRepresentation(2); // Surface
                actorProps.setColor(0, 1, 0); // Green
                actorProps.setOpacity(0.8);
                actorProps.setEdgeVisibility(true); // Show edges
                actorProps.setLineWidth(2); // Edge line width
                
                // Add actor to renderer
                window.renderer.addActor(actor);
                window.actor = actor;
                
                // Set up camera for 2D mesh
                const camera = window.renderer.getActiveCamera();
                const bounds = polydata.getBounds();
                const center = [
                    (bounds[0] + bounds[1]) / 2,
                    (bounds[2] + bounds[3]) / 2,
                    (bounds[4] + bounds[5]) / 2
                ];
                
                // Calculate distance based on mesh size
                const size = Math.max(bounds[1] - bounds[0], bounds[3] - bounds[2], bounds[5] - bounds[4]);
                const distance = size * 1.5;
                
                camera.setPosition(center[0], center[1], center[2] + distance);
                camera.setFocalPoint(center[0], center[1], center[2]);
                camera.setViewUp(0, 1, 0);
                
                // Force render
                window.renderWindow.render();
                
                console.log(`2D mesh created with ${vertices.length / 3} vertices`);
            } catch (error) {
                console.error('2D mesh creation error:', error);
            }
        }

        
        function createUnifiedMeshWithRepresentation(representation, viewType) {
            console.log(`Creating mesh with representation ${representation} for ${viewType} view`);
            
            // Remove existing actor to prevent overlay
            if (window.actor) {
                window.renderer.removeActor(window.actor);
                window.actor = null;
            }
            
            // Create polydata with the same base vertices for both views
            const polydata = vtk.Common.DataModel.vtkPolyData.newInstance();
            const points = vtk.Common.Core.vtkPoints.newInstance();
            const cellArray = vtk.Common.Core.vtkCellArray.newInstance();
            
            // Set vertices - ALWAYS the same for both views
            let vertices;
            const meshData = window.meshData.vertices || window.meshData;
            
            // Handle vertices correctly - they should be in [x,y,z] format
            if (Array.isArray(meshData) && meshData.length > 0 && Array.isArray(meshData[0])) {
                // Vertices are in [x,y,z] format - flatten them
                vertices = meshData.flat();
                console.log('Unified mesh: Vertices in [x,y,z] format, flattened to:', vertices.length / 3, 'vertices');
            } else if (Array.isArray(meshData) && meshData.length > 0) {
                // Vertices are already flattened
                vertices = meshData;
                console.log('Unified mesh: Vertices already flattened:', vertices.length / 3, 'vertices');
            } else {
                console.error('Invalid mesh data structure for unified mesh');
                return;
            }
            
            points.setData(new Float32Array(vertices), 3);
            polydata.setPoints(points);
            
            let totalElements = 0;
            
            // For points representation, create point cloud from all vertices
            if (representation === 0) {
            const pointArray = vtk.Common.Core.vtkCellArray.newInstance();
            for (let i = 0; i < vertices.length / 3; i++) {
                pointArray.insertNextCell([i]);
            }
            polydata.setVerts(pointArray);
            totalElements = vertices.length / 3;
            } else {
                // Handle 1D meshes (lines)
                if (window.meshDimension === 1) {
                    
                    if (window.cells && Object.keys(window.cells).length > 0) {
                        // Process 1D elements
                        if (window.cells.line && window.cells.line.length > 0) {
                            for (let i = 0; i < window.cells.line.length; i++) {
                                const line = window.cells.line[i];
                                if (Array.isArray(line) && line.length === 2) {
                                    cellArray.insertNextCell(line);
                                    totalElements++;
                                }
                            }
                        }
                        
                        if (window.cells.line_2nd && window.cells.line_2nd.length > 0) {
                            for (let i = 0; i < window.cells.line_2nd.length; i++) {
                                const line_2nd = window.cells.line_2nd[i];
                                if (Array.isArray(line_2nd) && line_2nd.length === 3) {
                                    // For second-order lines, use corner nodes only
                                    cellArray.insertNextCell([line_2nd[0], line_2nd[1]]);
                                    totalElements++;
                                }
                            }
                        }
                    }
                    
                    // Fallback to faces if no cells data available
                    if (totalElements === 0 && window.faces && window.faces.length > 0) {
                        for (let i = 0; i < window.faces.length; i++) {
                            const face = window.faces[i];
                            if (Array.isArray(face) && face.length >= 2) {
                                if (face.length === 2) {
                                    cellArray.insertNextCell(face);
                                    totalElements++;
                                } else if (face.length > 2) {
                                    // Split into line segments
                                    for (let j = 0; j < face.length; j++) {
                                        const next = (j + 1) % face.length;
                                        cellArray.insertNextCell([face[j], face[next]]);
                                        totalElements++;
                                    }
                                }
                            }
                        }
                    }
                    
                    if (totalElements > 0) {
                        polydata.setLines(cellArray);
                    }
                } else if (viewType === 'surface') {
                    // Surface view: show only surface elements (triangles, quads)
                    console.log('Processing surface elements for surface view');
                    
                    if (window.cells && Object.keys(window.cells).length > 0) {
                        // Process only surface elements
                    if (window.cells.triangle && window.cells.triangle.length > 0) {
                        for (let i = 0; i < window.cells.triangle.length; i++) {
                            const triangle = window.cells.triangle[i];
                            if (Array.isArray(triangle) && triangle.length === 3) {
                                cellArray.insertNextCell(triangle);
                                    totalElements++;
                            }
                        }
                    }
                    
                    if (window.cells.quad && window.cells.quad.length > 0) {
                        for (let i = 0; i < window.cells.quad.length; i++) {
                            const quad = window.cells.quad[i];
                            if (Array.isArray(quad) && quad.length === 4) {
                                // Split quad into two triangles
                                cellArray.insertNextCell([quad[0], quad[1], quad[2]]);
                                cellArray.insertNextCell([quad[0], quad[2], quad[3]]);
                                    totalElements += 2;
                            }
                        }
                    }
                    
                    if (window.cells.triangle_2nd && window.cells.triangle_2nd.length > 0) {
                        for (let i = 0; i < window.cells.triangle_2nd.length; i++) {
                            const triangle_2nd = window.cells.triangle_2nd[i];
                            if (Array.isArray(triangle_2nd) && triangle_2nd.length === 6) {
                                    // For second-order triangles, subdivide into 4 first-order triangles for smooth surface
                                    // Corner nodes: 0, 1, 2
                                    // Mid-edge nodes: 3, 4, 5 (between 0-1, 1-2, 2-0)
                                    
                                    // 4 triangles covering the entire second-order triangle
                                    cellArray.insertNextCell([triangle_2nd[0], triangle_2nd[3], triangle_2nd[5]]);
                                    cellArray.insertNextCell([triangle_2nd[3], triangle_2nd[1], triangle_2nd[4]]);
                                    cellArray.insertNextCell([triangle_2nd[5], triangle_2nd[4], triangle_2nd[2]]);
                                cellArray.insertNextCell([triangle_2nd[3], triangle_2nd[4], triangle_2nd[5]]);
                                    totalElements += 4;
                                }
                            }
                        }
                    }
                    
                    // Only include faces data if no cells data was processed
                    if (totalElements === 0 && window.faces && window.faces.length > 0) {
                        console.log(`Falling back to ${window.faces.length} faces for surface view`);
                    for (let i = 0; i < window.faces.length; i++) {
                        const face = window.faces[i];
                        if (Array.isArray(face) && face.length >= 3) {
                            if (face.length === 3) {
                                cellArray.insertNextCell(face);
                                    totalElements++;
                            } else if (face.length === 4) {
                                // Split quad into two triangles
                                cellArray.insertNextCell([face[0], face[1], face[2]]);
                                cellArray.insertNextCell([face[0], face[2], face[3]]);
                                    totalElements += 2;
                                }
                            }
                        }
                    }
                } else if (viewType === 'volume') {
                    // Volume view: show ALL elements (volume + surface)
                    console.log('Processing ALL elements for volume view');
                    
                    if (window.cells && Object.keys(window.cells).length > 0) {
                        // Process ALL elements from GMSH
                        for (const [cellType, cellData] of Object.entries(window.cells)) {
                            console.log(`Processing cell type: ${cellType}, count: ${cellData.length}`);
                            if (cellData && cellData.length > 0) {
                                for (let i = 0; i < cellData.length; i++) {
                                    const cell = cellData[i];
                                    if (Array.isArray(cell)) {
                                        // Process all element types
                                        if (cellType === 'tetrahedron' && cell.length === 4) {
                                            console.log(`Processing tetrahedron element ${i}`);
                                            cellArray.insertNextCell(cell);
                                            totalElements++;
                                        } else if (cellType === 'tetrahedron_2nd' && cell.length === 10) {
                                            console.log(`Processing tetrahedron_2nd element ${i}`);
                                            // For volume view, subdivide second-order tetrahedrons into 8 first-order tetrahedrons
                                            // Corner nodes: 0, 1, 2, 3
                                            // Mid-edge nodes: 4, 5, 6, 7, 8, 9 (edges 0-1, 1-2, 2-0, 0-3, 1-3, 2-3)
                                            
                                            // 8 tetrahedrons covering the entire second-order tetrahedron
                                            cellArray.insertNextCell([cell[0], cell[4], cell[6], cell[7]]);
                                            cellArray.insertNextCell([cell[4], cell[1], cell[5], cell[8]]);
                                            cellArray.insertNextCell([cell[6], cell[5], cell[2], cell[9]]);
                                            cellArray.insertNextCell([cell[7], cell[8], cell[9], cell[3]]);
                                            cellArray.insertNextCell([cell[4], cell[6], cell[7], cell[8]]);
                                            cellArray.insertNextCell([cell[4], cell[5], cell[6], cell[8]]);
                                            cellArray.insertNextCell([cell[5], cell[6], cell[8], cell[9]]);
                                            cellArray.insertNextCell([cell[6], cell[7], cell[8], cell[9]]);
                                            totalElements += 8;
                                        } else if (cellType === 'hexahedron' && cell.length === 8) {
                                            cellArray.insertNextCell(cell);
                                            totalElements++;
                                        } else if (cellType === 'triangle' && cell.length === 3) {
                                            cellArray.insertNextCell(cell);
                                            totalElements++;
                                        } else if (cellType === 'triangle_2nd' && cell.length === 6) {
                                            console.log(`Processing triangle_2nd element ${i}`);
                                            // Convert 2nd order triangle (6 nodes) to 3 linear triangles
                                            const v0 = cell[0], v1 = cell[1], v2 = cell[2];
                                            const v3 = cell[3], v4 = cell[4], v5 = cell[5];
                                            
                                            // 3 linear triangles
                                            cellArray.insertNextCell([v0, v3, v4]);
                                            cellArray.insertNextCell([v1, v4, v5]);
                                            cellArray.insertNextCell([v2, v5, v3]);
                                            totalElements += 3;
                                        } else if (cellType === 'line_2nd' && cell.length === 3) {
                                            console.log(`Processing line_2nd element ${i}`);
                                            // Convert 2nd order line (3 nodes) to 2 linear segments
                                            const v0 = cell[0], v1 = cell[1], v2 = cell[2];
                                            
                                            // 2 linear segments
                                            cellArray.insertNextCell([v0, v1]);
                                            cellArray.insertNextCell([v1, v2]);
                                            totalElements += 2;
                                        } else if (cellType === 'quad' && cell.length === 4) {
                                            cellArray.insertNextCell(cell);
                                            totalElements++;
                                        } else {
                                            console.log(`UNHANDLED cell type: ${cellType}, length: ${cell.length}`);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    
                    // Fallback to faces if no cells data available
                    if (totalElements === 0 && window.faces && window.faces.length > 0) {
                        console.log(`Falling back to ${window.faces.length} regular faces for volume view`);
                for (let i = 0; i < window.faces.length; i++) {
                    const face = window.faces[i];
                            if (Array.isArray(face) && face.length >= 3) {
                                if (face.length === 3) {
                                    cellArray.insertNextCell(face);
                                    totalElements++;
                                } else if (face.length === 4) {
                                    // Split quad into two triangles
                                    cellArray.insertNextCell([face[0], face[1], face[2]]);
                                    cellArray.insertNextCell([face[0], face[2], face[3]]);
                                    totalElements += 2;
                                }
                            }
                        }
                    }
                }
                
                if (totalElements > 0) {
                    polydata.setPolys(cellArray);
                }
            }
            
            // Create mapper and actor
            const mapper = vtk.Rendering.Core.vtkMapper.newInstance();
            mapper.setInputData(polydata);
            
            const actor = vtk.Rendering.Core.vtkActor.newInstance();
            actor.setMapper(mapper);
            
            // Set actor properties based on representation
            const actorProps = actor.getProperty();
            if (representation === 0) {
                actorProps.setRepresentation(0); // Points
                actorProps.setPointSize(3);
                actorProps.setColor(0, 1, 0); // Green
            } else if (representation === 1) {
                // Wireframe representation
                actorProps.setRepresentation(1); // Wireframe
                actorProps.setLineWidth(2);
                actorProps.setEdgeVisibility(true);
                actorProps.setColor(0, 1, 0); // Green
                
                // Wireframe shows different edges based on view type
            } else {
                // Surface representation
                actorProps.setRepresentation(2); // Surface
                actorProps.setOpacity(0.8);
                actorProps.setColor(0, 1, 0); // Green
                actorProps.setEdgeVisibility(true);
                actorProps.setLineWidth(1);
            }
            
            // Add actor to renderer
            window.renderer.addActor(actor);
            window.actor = actor;
            
            // Set up camera
            const camera = window.renderer.getActiveCamera();
            const bounds = polydata.getBounds();
            const center = [
                (bounds[0] + bounds[1]) / 2,
                (bounds[2] + bounds[3]) / 2,
                (bounds[4] + bounds[5]) / 2
            ];
            
            const size = Math.max(bounds[1] - bounds[0], bounds[3] - bounds[2], bounds[5] - bounds[4]);
            const distance = size * 2;
            
            camera.setPosition(center[0], center[1], center[2] + distance);
            camera.setFocalPoint(center[0], center[1], center[2]);
            camera.setViewUp(0, 1, 0);
            
            // Force render
            window.renderWindow.render();
            
            console.log(`${viewType} mesh created: ${totalElements} elements`);
            
            // Update mesh statistics
            updateInfo();
        }
        
        function updateInfo() {
            const fullMeshData = window.meshData;
            const faces = window.faces;
            const cells = window.cells;
            
            // Extract vertices array - handle both object format and flat array format
            let vertices;
            if (fullMeshData) {
                if (fullMeshData.vertices) {
                    // Object format with vertices property
                    vertices = fullMeshData.vertices;
                } else if (Array.isArray(fullMeshData)) {
                    // Flat array format
                    vertices = fullMeshData;
                } else {
                    vertices = null;
                }
            } else {
                vertices = null;
            }
            
            // Calculate vertex count - handle both nested and flat formats
            let vertexCount = 0;
            if (vertices) {
                if (Array.isArray(vertices) && vertices.length > 0) {
                    if (Array.isArray(vertices[0])) {
                        // Nested format: [[x,y,z], [x,y,z], ...]
                        vertexCount = vertices.length;
                    } else if (typeof vertices[0] === 'number') {
                        // Flat format: [x,y,z,x,y,z,...]
                        vertexCount = vertices.length / 3;
                    }
                }
            }
            
            document.getElementById('vertex-count').textContent = vertexCount;
            document.getElementById('face-count').textContent = faces ? faces.length : 0;
            
            // Set mesh type based on dimension
            if (window.meshDimension === 1) {
                document.getElementById('mesh-type').textContent = '1D Mesh';
            } else if (window.meshDimension === 2) {
                document.getElementById('mesh-type').textContent = '2D Mesh';
            } else {
                document.getElementById('mesh-type').textContent = '3D Mesh';
            }
            
        }
        
        // Field mapping functions removed from mesh preview
        
        // All field visualization and colorbar functionality removed from mesh preview
        
        
        window.addEventListener('resize', function() {
            if (renderWindow && renderWindow.getViews()[0]) {
                const vtkContainer = document.getElementById('vtk-container');
                const openGLRenderWindow = renderWindow.getViews()[0];
                openGLRenderWindow.setSize(window.vtkContainer.clientWidth, window.vtkContainer.clientHeight);
                renderWindow.render();
            }
        });
    </script>
</body>
</html>